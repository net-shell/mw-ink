function getRandomNum(t,e){return Math.random()*(e-t)+t}function onObjectSelected(t){var e=t.target;$("#text-string").val(""),e.hasRotatingPoint=!0,e&&"text"===e.type?($("#texteditor").css("display","block"),$("#text-string").val(e.getText()),$("#text-fontcolor").miniColors("value",e.fill),$("#text-strokecolor").miniColors("value",e.strokeStyle),$("#imageeditor").css("display","block")):e&&"image"===e.type&&($("#texteditor").css("display","none"),$("#imageeditor").css("display","block"))}function onSelectedCleared(t){$("#texteditor").css("display","none"),$("#text-string").val(""),$("#imageeditor").css("display","none")}function setFont(t){var e=canvas.getActiveObject();e&&"text"===e.type&&(e.fontFamily=t,canvas.renderAll())}function removeWhite(){var t=canvas.getActiveObject();t&&"image"===t.type&&(t.filters[2]=new fabric.Image.filters.RemoveWhite({hreshold:100,distance:10}),t.applyFilters(canvas.renderAll.bind(canvas)))}var fabric=fabric||{version:"0.9.13"};"undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow()),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window;var Cufon=function(){function t(t){var e=this.face=t.face;this.glyphs=t.glyphs,this.w=t.w,this.baseSize=parseInt(e["units-per-em"],10),this.family=e["font-family"].toLowerCase(),this.weight=e["font-weight"],this.style=e["font-style"]||"normal",this.viewBox=function(){var t=e.bbox.split(/\s+/),i={minX:parseInt(t[0],10),minY:parseInt(t[1],10),maxX:parseInt(t[2],10),maxY:parseInt(t[3],10)};return i.width=i.maxX-i.minX,i.height=i.maxY-i.minY,i.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")},i}(),this.ascent=-parseInt(e.ascent,10),this.descent=-parseInt(e.descent,10),this.height=-this.ascent+this.descent}function e(){var t={},e={oblique:"italic",italic:"oblique"};this.add=function(e){(t[e.style]||(t[e.style]={}))[e.weight]=e},this.get=function(i,r){var n=t[i]||t[e[i]]||t.normal||t.italic||t.oblique;if(!n)return null;if(r={normal:400,bold:700}[r]||parseInt(r,10),n[r])return n[r];var o,s,a={1:1,99:0}[r%100],c=[];void 0===a&&(a=r>400),500==r&&(r=400);for(var h in n)h=parseInt(h,10),(!o||o>h)&&(o=h),(!s||h>s)&&(s=h),c.push(h);return o>r&&(r=o),r>s&&(r=s),c.sort(function(t,e){return(a?t>r&&e>r?e>t:t>e:r>t&&r>e?t>e:e>t)?-1:1}),n[c[0]]}}function i(){function t(t,e){return t.contains?t.contains(e):16&t.compareDocumentPosition(e)}function e(e){var i=e.relatedTarget;i&&!t(this,i)&&r(this)}function i(t){r(this)}function r(t){setTimeout(function(){d.replace(t,b.get(t).options,!0)},10)}this.attach=function(t){void 0===t.onmouseenter?(o(t,"mouseover",e),o(t,"mouseout",e)):(o(t,"mouseenter",i),o(t,"mouseleave",i))}}function r(){function t(t){return t.cufid||(t.cufid=++i)}var e={},i=0;this.get=function(i){var r=t(i);return e[r]||(e[r]={})}}function n(t){var e={},i={};this.get=function(i){return void 0!=e[i]?e[i]:t[i]},this.getSize=function(t,e){return i[t]||(i[t]=new g.Size(this.get(t),e))},this.extend=function(t){for(var i in t)e[i]=t[i];return this}}function o(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,function(){return i.call(t,fabric.window.event)})}function s(t,e){var i=b.get(t);return i.options?t:(e.hover&&e.hoverables[t.nodeName.toLowerCase()]&&m.attach(t),i.options=e,t)}function a(t){var e={};return function(i){return e.hasOwnProperty(i)||(e[i]=t.apply(null,arguments)),e[i]}}function c(t,e){e||(e=g.getStyle(t));for(var i,r=g.quotedList(e.get("fontFamily").toLowerCase()),n=0,o=r.length;o>n;++n)if(i=r[n],C[i])return C[i].get(e.get("fontStyle"),e.get("fontWeight"));return null}function h(t){return fabric.document.getElementsByTagName(t)}function l(){for(var t,e={},i=0,r=arguments.length;r>i;++i)for(t in arguments[i])e[t]=arguments[i][t];return e}function u(t,e,i,r,n,o){var s=r.separate;if("none"==s)return x[r.engine].apply(null,arguments);var a,c=fabric.document.createDocumentFragment(),h=e.split(S[s]),l="words"==s;l&&v&&(/^\s/.test(e)&&h.unshift(""),/\s$/.test(e)&&h.push(""));for(var u=0,f=h.length;f>u;++u)a=x[r.engine](t,l?g.textAlign(h[u],i,u,f):h[u],i,r,n,o,f-1>u),a&&c.appendChild(a);return c}function f(t,e){for(var i,r,n,o,a=s(t,e).firstChild;a;a=n){if(n=a.nextSibling,o=!1,1==a.nodeType){if(!a.firstChild)continue;if(!/cufon/.test(a.className)){arguments.callee(a,e);continue}o=!0}if(r||(r=g.getStyle(t).extend(e)),i||(i=c(t,r)),i)if(o)x[e.engine](i,null,r,e,a,t);else{var h=a.data;if("undefined"!=typeof G_vmlCanvasManager&&(h=h.replace(/\r/g,"\n")),""!==h){var l=u(i,h,r,e,a,t);l?a.parentNode.replaceChild(l,a):a.parentNode.removeChild(a)}}}}var d=function(){return d.replace.apply(null,arguments)},p=d.DOM={ready:function(){var t=!1,e={loaded:1,complete:1},i=[],r=function(){if(!t){t=!0;for(var e;e=i.shift();e());}};return fabric.document.addEventListener&&(fabric.document.addEventListener("DOMContentLoaded",r,!1),fabric.window.addEventListener("pageshow",r,!1)),!fabric.window.opera&&fabric.document.readyState&&function(){e[fabric.document.readyState]?r():setTimeout(arguments.callee,10)}(),fabric.document.readyState&&fabric.document.createStyleSheet&&function(){try{fabric.document.body.doScroll("left"),r()}catch(t){setTimeout(arguments.callee,1)}}(),o(fabric.window,"load",r),function(e){arguments.length?t?e():i.push(e):r()}}()},g=d.CSS={Size:function(t,e){this.value=parseFloat(t),this.unit=String(t).match(/[a-z%]*$/)[0]||"px",this.convert=function(t){return t/e*this.value},this.convertFrom=function(t){return t/this.value*e},this.toString=function(){return this.value+this.unit}},getStyle:function(t){return new n(t.style)},quotedList:a(function(t){for(var e,i=[],r=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g;e=r.exec(t);)i.push(e[3]||e[1]);return i}),ready:function(){var t=!1,e=[],i=function(){t=!0;for(var i;i=e.shift();i());},r=Object.prototype.propertyIsEnumerable?h("style"):{length:0},n=h("link");return p.ready(function(){for(var t,e=0,o=0,s=n.length;t=n[o],s>o;++o)t.disabled||"stylesheet"!=t.rel.toLowerCase()||++e;fabric.document.styleSheets.length>=r.length+e?i():setTimeout(arguments.callee,10)}),function(i){t?i():e.push(i)}}(),supports:function(t,e){var i=fabric.document.createElement("span").style;return void 0===i[t]?!1:(i[t]=e,i[t]===e)},textAlign:function(t,e,i,r){return"right"==e.get("textAlign")?i>0&&(t=" "+t):r-1>i&&(t+=" "),t},textDecoration:function(t,e){e||(e=this.getStyle(t));for(var i={underline:null,overline:null,"line-through":null},r=t;r.parentNode&&1==r.parentNode.nodeType;){var n=!0;for(var o in i)i[o]||(-1!=e.get("textDecoration").indexOf(o)&&(i[o]=e.get("color")),n=!1);if(n)break;e=this.getStyle(r=r.parentNode)}return i},textShadow:a(function(t){if("none"==t)return null;for(var e,i=[],r={},n=0,o=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/gi;e=o.exec(t);)","==e[0]?(i.push(r),r={},n=0):e[1]?r.color=e[1]:r[["offX","offY","blur"][n++]]=e[2];return i.push(r),i}),color:a(function(t){var e={};return e.color=t.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(t,i,r){return e.opacity=parseFloat(r),"rgb("+i+")"}),e}),textTransform:function(t,e){return t[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[e.get("textTransform")]||"toString"]()}},v=0==" ".split(/\s+/).length,b=new r,m=new i,y=[],x={},C={},w={engine:null,hover:!1,hoverables:{a:!0},printable:!0,selector:fabric.window.Sizzle||fabric.window.jQuery&&function(t){return jQuery(t)}||fabric.window.dojo&&dojo.query||fabric.window.$$&&function(t){return $$(t)}||fabric.window.$&&function(t){return $(t)}||fabric.document.querySelectorAll&&function(t){return fabric.document.querySelectorAll(t)}||h,separate:"words",textShadow:"none"},S={words:/\s+/,characters:""};return d.now=function(){return p.ready(),d},d.refresh=function(){for(var t=y.splice(0,y.length),e=0,i=t.length;i>e;++e)d.replace.apply(null,t[e]);return d},d.registerEngine=function(t,e){return e?(x[t]=e,d.set("engine",t)):d},d.registerFont=function(i){var r=new t(i),n=r.family;return C[n]||(C[n]=new e),C[n].add(r),d.set("fontFamily",'"'+n+'"')},d.replace=function(t,e,i){return e=l(w,e),e.engine?("string"==typeof e.textShadow&&e.textShadow&&(e.textShadow=g.textShadow(e.textShadow)),i||y.push(arguments),(t.nodeType||"string"==typeof t)&&(t=[t]),g.ready(function(){for(var i=0,r=t.length;r>i;++i){var n=t[i];"string"==typeof n?d.replace(e.selector(n),e,!0):f(n,e)}}),d):d},d.replaceElement=function(t,e){return e=l(w,e),"string"==typeof e.textShadow&&e.textShadow&&(e.textShadow=g.textShadow(e.textShadow)),f(t,e)},d.engines=x,d.fonts=C,d.getOptions=function(){return l(w)},d.set=function(t,e){return w[t]=e,d},d}();Cufon.registerEngine("canvas",function(){function t(t,e){var i,r=0,n=0,o=[],s=/([mrvxe])([^a-z]*)/g;t:for(var a=0;i=s.exec(t);++a){var c=i[2].split(",");switch(i[1]){case"v":o[a]={m:"bezierCurveTo",a:[r+~~c[0],n+~~c[1],r+~~c[2],n+~~c[3],r+=~~c[4],n+=~~c[5]]};break;case"r":o[a]={m:"lineTo",a:[r+=~~c[0],n+=~~c[1]]};break;case"m":o[a]={m:"moveTo",a:[r=~~c[0],n=~~c[1]]};break;case"x":o[a]={m:"closePath",a:[]};break;case"e":break t}e[o[a].m].apply(e,o[a].a)}return o}function e(t,e){for(var i=0,r=t.length;r>i;++i){var n=t[i];e[n.m].apply(e,n.a)}}var i=Cufon.CSS.supports("display","inline-block"),r=!i&&("BackCompat"==fabric.document.compatMode||/frameset|transitional/i.test(fabric.document.doctype.publicId)),n=fabric.document.createElement("style");n.type="text/css";var o=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(r?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+(i?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{n.appendChild(o)}catch(s){n.setAttribute("type","text/css"),n.styleSheet.cssText=o.data}return fabric.document.getElementsByTagName("head")[0].appendChild(n),function(r,n,o,s,a,c){function h(){U.save(),U.fillStyle=s.backgroundColor;var t=0,e=0,i=[{left:0}];"right"===s.textAlign?(U.translate(M[e],0),i[0].left=M[e]*V):"center"===s.textAlign&&(U.translate(M[e]/2,0),i[0].left=M[e]/2*V);for(var n=0,o=j.length;o>n;++n)if("\n"!==j[n]){var a=r.glyphs[j[n]]||r.missingGlyph;if(a){var c=Number(a.w||r.w)+p;s.backgroundColor&&(U.save(),U.translate(0,r.ascent),U.fillRect(0,0,c+10,-r.ascent+r.descent),U.restore()),U.translate(c,0),t+=c,n==o-1&&(i[i.length-1].width=t*V,i[i.length-1].height=(-r.ascent+r.descent)*V)}}else{e++;var h=-r.ascent-r.ascent/5*s.lineHeight,l=i[i.length-1],u={left:0};l.width=t*V,l.height=(-r.ascent+r.descent)*V,"right"===s.textAlign?(U.translate(-T,h),U.translate(M[e],0),u.left=M[e]*V):"center"===s.textAlign?(U.translate(-t-M[e-1]/2,h),U.translate(M[e]/2,0),u.left=M[e]/2*V):U.translate(-t,h),i.push(u),t=0}U.restore(),Cufon.textOptions.boundaries=i}function l(i){U.fillStyle=i||Cufon.textOptions.color||o.get("color");var n=0,a=0;"right"===s.textAlign?U.translate(M[a],0):"center"===s.textAlign&&U.translate(M[a]/2,0);for(var c=0,h=j.length;h>c;++c)if("\n"!==j[c]){var l=r.glyphs[j[c]]||r.missingGlyph;if(l){var u=Number(l.w||r.w)+p;$&&(U.save(),U.strokeStyle=U.fillStyle,U.lineWidth+=U.lineWidth,U.beginPath(),$.underline&&(U.moveTo(0,-r.face["underline-position"]+.5),U.lineTo(u,-r.face["underline-position"]+.5)),$.overline&&(U.moveTo(0,r.ascent+.5),U.lineTo(u,r.ascent+.5)),$["line-through"]&&(U.moveTo(0,-r.descent+.5),U.lineTo(u,-r.descent+.5)),U.stroke(),U.restore()),J&&(U.save(),U.transform(1,0,-.25,1,0,0)),U.beginPath(),l.d&&(l.code?e(l.code,U):l.code=t("m"+l.d,U)),U.fill(),s.strokeStyle&&(U.closePath(),U.save(),U.lineWidth=s.strokeWidth,U.strokeStyle=s.strokeStyle,U.stroke(),U.restore()),J&&U.restore(),U.translate(u,0),n+=u}}else{a++;var f=-r.ascent-r.ascent/5*s.lineHeight;"right"===s.textAlign?(U.translate(-T,f),U.translate(M[a],0)):"center"===s.textAlign?(U.translate(-n-M[a-1]/2,f),U.translate(M[a]/2,0)):U.translate(-n,f),n=0}}var u=null===n,f=r.viewBox,d=o.getSize("fontSize",r.baseSize),p=o.get("letterSpacing");p="normal"==p?0:d.convertFrom(parseInt(p,10));var g=0,v=0,b=0,m=0,y=s.textShadow,x=[];if(Cufon.textOptions.shadowOffsets=[],Cufon.textOptions.shadows=null,y){Cufon.textOptions.shadows=y;for(var C=0,w=y.length;w>C;++C){var S=y[C],_=d.convertFrom(parseFloat(S.offX)),O=d.convertFrom(parseFloat(S.offY));x[C]=[_,O]}}for(var j=Cufon.CSS.textTransform(u?a.alt:n,o).split(""),T=0,A=null,k=0,I=1,E=[],C=0,w=j.length;w>C;++C)if("\n"!==j[C]){var P=r.glyphs[j[C]]||r.missingGlyph;P&&(T+=A=Number(P.w||r.w)+p)}else I++,T>k&&(k=T),E.push(T),T=0;E.push(T),T=Math.max(k,T);for(var M=[],C=E.length;C--;)M[C]=T-E[C];if(null===A)return null;v+=f.width-A,m+=f.minX;var D,F;if(u)D=a,F=a.firstChild;else if(D=fabric.document.createElement("span"),D.className="cufon cufon-canvas",D.alt=n,F=fabric.document.createElement("canvas"),D.appendChild(F),s.printable){var R=fabric.document.createElement("span");R.className="cufon-alt",R.appendChild(fabric.document.createTextNode(n)),D.appendChild(R)}var L=D.style,N=F.style||{},G=d.convert(f.height-g+b),W=Math.ceil(G),B=W/G;F.width=Math.ceil(d.convert(T+v-m)*B),F.height=W,g+=f.minY,N.top=Math.round(d.convert(g-r.ascent))+"px",N.left=Math.round(d.convert(m))+"px";var z=Math.ceil(d.convert(T*B)),X=z+"px",H=d.convert(r.height),Y=(s.lineHeight-1)*d.convert(-r.ascent/5)*(I-1);Cufon.textOptions.width=z,Cufon.textOptions.height=H*I+Y,Cufon.textOptions.lines=I,Cufon.textOptions.totalLineHeight=Y,i?(L.width=X,L.height=H+"px"):(L.paddingLeft=X,L.paddingBottom=H-1+"px");var U=Cufon.textOptions.context||F.getContext("2d"),V=W/f.height;Cufon.textOptions.fontAscent=r.ascent*V,Cufon.textOptions.boundaries=null;for(var q=Cufon.textOptions.shadowOffsets,C=x.length;C--;)q[C]=[x[C][0]*V,x[C][1]*V];U.save(),U.scale(V,V),U.translate(-m-1/V*F.width/2+(Cufon.fonts[r.family].offsetLeft||0),-g-Cufon.textOptions.height/V/2+(Cufon.fonts[r.family].offsetTop||0)),U.lineWidth=r.face["underline-thickness"],U.save();var $=Cufon.getTextDecoration(s),J="italic"===s.fontStyle;if(U.save(),h(),y)for(var C=0,w=y.length;w>C;++C){var S=y[C];U.save(),U.translate.apply(U,x[C]),l(S.color),U.restore()}return l(),U.restore(),U.restore(),U.restore(),D}}()),Cufon.registerEngine("vml",function(){function t(t,i){return e(t,/(?:em|ex|%)$/i.test(i)?"1em":i)}function e(t,e){if(/px$/i.test(e))return parseFloat(e);var i=t.style.left,r=t.runtimeStyle.left;t.runtimeStyle.left=t.currentStyle.left,t.style.left=e;var n=t.style.pixelLeft;return t.style.left=i,t.runtimeStyle.left=r,n}if(fabric.document.namespaces){var i=fabric.document.createElement("canvas");if(!(i&&i.getContext&&i.getContext.apply)){null==fabric.document.namespaces.cvml&&fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml");var r=fabric.document.createElement("cvml:shape");if(r.style.behavior="url(#default#VML)",r.coordsize)return r=null,fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>'),function(i,r,n,o,s,a,c){var h=null===r;h&&(r=s.alt);var l=i.viewBox,u=n.computedFontSize||(n.computedFontSize=new Cufon.CSS.Size(t(a,n.get("fontSize"))+"px",i.baseSize)),f=n.computedLSpacing;void 0==f&&(f=n.get("letterSpacing"),n.computedLSpacing=f="normal"==f?0:~~u.convertFrom(e(a,f)));var d,p;if(h)d=s,p=s.firstChild;else{if(d=fabric.document.createElement("span"),d.className="cufon cufon-vml",d.alt=r,p=fabric.document.createElement("span"),p.className="cufon-vml-canvas",d.appendChild(p),o.printable){var g=fabric.document.createElement("span");g.className="cufon-alt",g.appendChild(fabric.document.createTextNode(r)),d.appendChild(g)}c||d.appendChild(fabric.document.createElement("cvml:shape"))}var v=d.style,b=p.style,m=u.convert(l.height),y=Math.ceil(m),x=y/m,C=l.minX,w=l.minY;b.height=y,b.top=Math.round(u.convert(w-i.ascent)),b.left=Math.round(u.convert(C)),v.height=u.convert(i.height)+"px";for(var S,_,O=(Cufon.getTextDecoration(o),n.get("color")),j=Cufon.CSS.textTransform(r,n).split(""),T=0,A=0,k=null,I=o.textShadow,E=0,P=0,M=j.length;M>E;++E)S=i.glyphs[j[E]]||i.missingGlyph,S&&(T+=k=~~(S.w||i.w)+f);if(null===k)return null;var D,F=-C+T+(l.width-k),R=u.convert(F*x),L=Math.round(R),N=F+","+l.height,G="r"+N+"nsnf";for(E=0;M>E;++E)if(S=i.glyphs[j[E]]||i.missingGlyph){h?(_=p.childNodes[P],_.firstChild&&_.removeChild(_.firstChild)):(_=fabric.document.createElement("cvml:shape"),p.appendChild(_)),_.stroked="f",_.coordsize=N,_.coordorigin=D=C-A+","+w,_.path=(S.d?"m"+S.d+"xe":"")+"m"+D+G,_.fillcolor=O;var W=_.style;if(W.width=L,W.height=y,I){var B,z=I[0],X=I[1],H=Cufon.CSS.color(z.color),Y=fabric.document.createElement("cvml:shadow");Y.on="t",Y.color=H.color,Y.offset=z.offX+","+z.offY,X&&(B=Cufon.CSS.color(X.color),Y.type="double",Y.color2=B.color,Y.offset2=X.offX+","+X.offY),Y.opacity=H.opacity||B&&B.opacity||1,_.appendChild(Y)}A+=~~(S.w||i.w)+f,++P}return v.width=Math.max(Math.ceil(u.convert(T*x)),0),d}}}}()),Cufon.getTextDecoration=function(t){return{underline:"underline"===t.textDecoration,overline:"overline"===t.textDecoration,"line-through":"line-through"===t.textDecoration}},"undefined"!=typeof exports&&(exports.Cufon=Cufon);var JSON;JSON||(JSON={}),function(){"use strict";function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,r,n,o,s,a=gap,c=e[t];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(t)),"function"==typeof rep&&(c=rep.call(e,t,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,i=0;o>i;i+=1)s[i]=str(i,c)||"null";return n=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,n}if(rep&&"object"==typeof rep)for(o=rep.length,i=0;o>i;i+=1)"string"==typeof rep[i]&&(r=rep[i],n=str(r,c),n&&s.push(quote(r)+(gap?": ":":")+n));else for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(n=str(r,c),n&&s.push(quote(r)+(gap?": ":":")+n));return n=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,n}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(t){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(t){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,i){var r;if(gap="",indent="","number"==typeof i)for(r=0;i>r;r+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var i,r,n=t[e];if(n&&"object"==typeof n)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r=walk(n,i),void 0!==r?n[i]=r:delete n[i]);return reviver.call(t,e,n)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&("undefined"!=typeof console.log&&console.log.apply&&(fabric.log=function(){return console.log.apply(console,arguments)}),"undefined"!=typeof console.warn&&console.warn.apply&&(fabric.warn=function(){return console.warn.apply(console,arguments)})),fabric.Observable={observe:function(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e)},stopObserving:function(t,e){this.__eventListeners||(this.__eventListeners={}),this.__eventListeners[t]&&fabric.util.removeFromArray(this.__eventListeners[t],e)},fire:function(t,e){this.__eventListeners||(this.__eventListeners={});var i=this.__eventListeners[t];if(i)for(var r=0,n=i.length;n>r;r++)i[r](e||{})}},fabric.Observable.on=fabric.Observable.observe,fabric.Observable.off=fabric.Observable.stopObserving,function(){function t(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t}function e(t,e){return Math.floor(Math.random()*(e-t+1))+t}function i(t){return t*h}function r(t,e){return parseFloat(Number(t).toFixed(e))}function n(){return!1}function o(t){t||(t={});var e,i=+new Date,r=t.duration||500,n=i+r,o=t.onChange||function(){},s=t.abort||function(){return!1},a=t.easing||function(t,e,i,r){return-i*Math.cos(t/r*(Math.PI/2))+i+e},c="startValue"in t?t.startValue:0,h="endValue"in t?t.endValue:100;byValue=t.byValue||h-c,t.onStart&&t.onStart(),function l(){return e=+new Date,currentTime=e>n?r:e-i,o(a(currentTime,c,byValue,r)),e>n||s()?void(t.onComplete&&t.onComplete()):void u(l)}()}function s(t,e,i){if(t){var r=new Image;r.onload=function(){e&&e.call(i,r),r=r.onload=null},r.src=t}else e&&e.call(i,t)}function a(t,e){function i(t){return fabric[fabric.util.string.camelize(fabric.util.string.capitalize(t))]}function r(){++o===s&&e&&e(n)}var n=[],o=0,s=t.length;t.forEach(function(t,e){if(t.type){var o=i(t.type);o.async?o.fromObject(t,function(t){n[e]=t,r()}):(n[e]=o.fromObject(t),r())}})}function c(t,e,i){var r=t.length>1?new fabric.PathGroup(t,e):t[0];return"undefined"!=typeof i&&r.setSourcePath(i),r}fabric.util={};var h=Math.PI/180,l=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(t,e){fabric.window.setTimeout(t,1e3/60)},u=function(){return l.apply(fabric.window,arguments)};fabric.util.removeFromArray=t,fabric.util.degreesToRadians=i,fabric.util.toFixed=r,fabric.util.getRandomInt=e,fabric.util.falseFunction=n,fabric.util.animate=o,fabric.util.requestAnimFrame=u,fabric.util.loadImage=s,fabric.util.enlivenObjects=a,fabric.util.groupSVGElements=c}(),function(){function t(t,e){for(var i=r.call(arguments,2),n=[],o=0,s=t.length;s>o;o++)n[o]=i.length?t[o][e].apply(t[o],i):t[o][e].call(t[o]);return n}function e(t,e){if(t&&0!==t.length){var i=t.length-1,r=e?t[i][e]:t[i];if(e)for(;i--;)t[i][e]>=r&&(r=t[i][e]);else for(;i--;)t[i]>=r&&(r=t[i]);return r}}function i(t,e){if(t&&0!==t.length){var i=t.length-1,r=e?t[i][e]:t[i];if(e)for(;i--;)t[i][e]<r&&(r=t[i][e]);else for(;i--;)t[i]<r&&(r=t[i]);return r}}var r=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0===i)return-1;var r=0;if(arguments.length>0&&(r=Number(arguments[1]),r!==r?r=0:0!==r&&r!==1/0&&r!==-(1/0)&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=i)return-1;for(var n=r>=0?r:Math.max(i-Math.abs(r),0);i>n;n++)if(n in e&&e[n]===t)return n;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var i=0,r=this.length>>>0;r>i;i++)i in this&&t.call(e,this[i],i,this)}),Array.prototype.map||(Array.prototype.map=function(t,e){for(var i=[],r=0,n=this.length>>>0;n>r;r++)r in this&&(i[r]=t.call(e,this[r],r,this));return i}),Array.prototype.every||(Array.prototype.every=function(t,e){for(var i=0,r=this.length>>>0;r>i;i++)if(i in this&&!t.call(e,this[i],i,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t,e){for(var i=0,r=this.length>>>0;r>i;i++)if(i in this&&t.call(e,this[i],i,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(t,e){for(var i,r=[],n=0,o=this.length>>>0;o>n;n++)n in this&&(i=this[n],t.call(e,i,n,this)&&r.push(i));return r}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var e,i=this.length>>>0,r=0;if(arguments.length>1)e=arguments[1];else for(;;){if(r in this){e=this[r++];break}if(++r>=i)throw new TypeError}for(;i>r;r++)r in this&&(e=t.call(null,e,this[r],r,this));return e}),fabric.util.array={invoke:t,min:i,max:e}}(),function(){function t(t,e){for(var i in e)t[i]=e[i];return t}function e(e){return t({},e)}fabric.util.object={extend:t,clone:e}}(),function(){function t(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})}function e(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}function i(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:t,capitalize:e,escapeXml:i}}(),function(){var t=Array.prototype.slice,e=Function.prototype.apply,i=function(){};Function.prototype.bind||(Function.prototype.bind=function(r){var n,o=this,s=t.call(arguments,1);return n=s.length?function(){return e.call(o,this instanceof i?this:r,s.concat(t.call(arguments)))}:function(){return e.call(o,this instanceof i?this:r,arguments)},i.prototype=this.prototype,n.prototype=new i,n})}(),function(){function t(){}function e(){function e(){this.initialize.apply(this,arguments)}var n=null,s=i.call(arguments,0);"function"==typeof s[0]&&(n=s.shift()),e.superclass=n,e.subclasses=[],n&&(t.prototype=n.prototype,e.prototype=new t,n.subclasses.push(e));for(var a=0,c=s.length;c>a;a++)o(e,s[a],n);return e.prototype.initialize||(e.prototype.initialize=r),e.prototype.constructor=e,e}var i=Array.prototype.slice,r=function(){},n=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),o=function(t,e,i){for(var r in e)r in t.prototype&&"function"==typeof t.prototype[r]?t.prototype[r]=function(t){return function(){var r=this.constructor.superclass;this.constructor.superclass=i;var n=e[t].apply(this,arguments);return this.constructor.superclass=r,"initialize"!==t?n:void 0}}(r):t.prototype[r]=e[r],n&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};fabric.util.createClass=e}(),function(t){function e(t){var e,i,r=Array.prototype.slice.call(arguments,1),n=r.length;for(i=0;n>i;i++)if(e=typeof t[r[i]],!/^(?:function|object|unknown)$/.test(e))return!1;return!0}function i(t,e){return{handler:e,wrappedHandler:r(t,e)}}function r(t,e){return function(i){e.call(c(t),i||fabric.window.event)}}function n(t,e){return function(i){if(v[t]&&v[t][e])for(var r=v[t][e],n=0,o=r.length;o>n;n++)r[n].call(this,i||fabric.window.event)}}function o(t){return{x:s(t),y:a(t)}}function s(t){var e=fabric.document.documentElement,i=fabric.document.body||{scrollLeft:0};return t.pageX||("unknown"!=typeof t.clientX?t.clientX:0)+(e.scrollLeft||i.scrollLeft)-(e.clientLeft||0)}function a(t){var e=fabric.document.documentElement,i=fabric.document.body||{scrollTop:0};return t.pageY||("unknown"!=typeof t.clientY?t.clientY:0)+(e.scrollTop||i.scrollTop)-(e.clientTop||0)}var c,h,l=function(){if("undefined"!=typeof fabric.document.documentElement.uniqueID)return function(t){return t.uniqueID};var t=0;return function(e){return e.__uniqueID||(e.__uniqueID="uniqueID__"+t++)}}();!function(){var t={};c=function(e){return t[e]},h=function(e,i){t[e]=i}}();var u,f,d=e(fabric.document.documentElement,"addEventListener","removeEventListener")&&e(fabric.window,"addEventListener","removeEventListener"),p=e(fabric.document.documentElement,"attachEvent","detachEvent")&&e(fabric.window,"attachEvent","detachEvent"),g={},v={};d?(u=function(t,e,i){t.addEventListener(e,i,!1)},f=function(t,e,i){t.removeEventListener(e,i,!1)}):p?(u=function(t,e,r){var n=l(t);h(n,t),g[n]||(g[n]={}),g[n][e]||(g[n][e]=[]);var o=i(n,r);g[n][e].push(o),t.attachEvent("on"+e,o.wrappedHandler)},f=function(t,e,i){var r,n=l(t);if(g[n]&&g[n][e])for(var o=0,s=g[n][e].length;s>o;o++)r=g[n][e][o],r&&r.handler===i&&(t.detachEvent("on"+e,r.wrappedHandler),g[n][e][o]=null)}):(u=function(t,e,i){var r=l(t);if(v[r]||(v[r]={}),!v[r][e]){v[r][e]=[];var o=t["on"+e];o&&v[r][e].push(o),t["on"+e]=n(r,e)}v[r][e].push(i)},f=function(t,e,i){var r=l(t);if(v[r]&&v[r][e])for(var n=v[r][e],o=0,s=n.length;s>o;o++)n[o]===i&&n.splice(o,1)}),fabric.util.addListener=u,fabric.util.removeListener=f,fabric.isTouchSupported&&(s=function(t){return t.touches&&t.touches[0]&&t.touches[0].pageX||t.clientX},a=function(t){return t.touches&&t.touches[0]&&t.touches[0].pageY||t.clientY}),fabric.util.getPointer=o,fabric.util.object.extend(fabric.util,fabric.Observable)}(this),function(){function t(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,e.indexOf("opacity")>-1?s(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var r in e)if("opacity"===r)s(t,e[r]);else{var n="float"===r||"cssFloat"===r?"undefined"==typeof i.styleFloat?"cssFloat":"styleFloat":r;i[n]=e[r]}return t}var e=fabric.document.createElement("div"),i="string"==typeof e.style.opacity,r="string"==typeof e.style.filter,n=fabric.document.defaultView,o=(n&&"undefined"!=typeof n.getComputedStyle,/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/),s=function(t){return t};i?s=function(t,e){return t.style.opacity=e,t}:r&&(s=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),o.test(i.filter)?(e=e>=.9999?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(o,e)):i.filter+=" alpha(opacity="+100*e+")",t}),fabric.util.setStyle=t}(),function(){function t(t){return"string"==typeof t?fabric.document.getElementById(t):t}function e(t){return s.call(t,0)}function i(t,e){var i=fabric.document.createElement(t);for(var r in e)"class"===r?i.className=e[r]:"for"===r?i.htmlFor=e[r]:i.setAttribute(r,e[r]);return i}function r(t,e){-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)}function n(t,e,r){return"string"==typeof e&&(e=i(e,r)),t.parentNode&&t.parentNode.replaceChild(e,t),e.appendChild(t),e}function o(t){var e=0,i=0;do e+=t.offsetTop||0,i+=t.offsetLeft||0,t=t.offsetParent;while(t);return{left:i,top:e}}var s=Array.prototype.slice;try{var a=e(fabric.document.childNodes)instanceof Array}catch(c){}a||(e=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e}),function(){function t(t){return"undefined"!=typeof t.onselectstart&&(t.onselectstart=fabric.util.falseFunction),r?t.style[r]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t}function e(t){return"undefined"!=typeof t.onselectstart&&(t.onselectstart=null),
r?t.style[r]="":"string"==typeof t.unselectable&&(t.unselectable=""),t}var i=fabric.document.documentElement.style,r="userSelect"in i?"userSelect":"MozUserSelect"in i?"MozUserSelect":"WebkitUserSelect"in i?"WebkitUserSelect":"KhtmlUserSelect"in i?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=t,fabric.util.makeElementSelectable=e}(),function(){function t(t,e){var i=fabric.document.getElementsByTagName("head")[0],r=fabric.document.createElement("script"),n=!0;r.type="text/javascript",r.setAttribute("runat","server"),r.onload=r.onreadystatechange=function(t){if(n){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;n=!1,e(t||fabric.window.event),r=r.onload=r.onreadystatechange=null}},r.src=t,i.appendChild(r)}fabric.util.getScript=t}(),fabric.util.getById=t,fabric.util.toArray=e,fabric.util.makeElement=i,fabric.util.addClass=r,fabric.util.wrapElement=n,fabric.util.getElementOffset=o}(),function(){function t(t,e){return t+(/\?/.test(t)?"&":"?")+e}function e(){}function i(i,n){n||(n={});var o,s=n.method?n.method.toUpperCase():"GET",a=n.onComplete||function(){},c=r();return c.onreadystatechange=function(){4===c.readyState&&(a(c),c.onreadystatechange=e)},"GET"===s&&(o=null,"string"==typeof n.parameters&&(i=t(i,n.parameters))),c.open(s,i,!0),"POST"!==s&&"PUT"!==s||c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(o),c}var r=function(){for(var t=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],e=t.length;e--;)try{var i=t[e]();if(i)return t[e]}catch(r){}}();fabric.util.request=i}(),function(){function t(t,e,i,r){return i*(t/=r)*t+e}function e(t,e,i,r){return-i*(t/=r)*(t-2)+e}function i(t,e,i,r){return(t/=r/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e}function r(t,e,i,r){return i*(t/=r)*t*t+e}function n(t,e,i,r){return i*((t=t/r-1)*t*t+1)+e}function o(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e}function s(t,e,i,r){return i*(t/=r)*t*t*t+e}function a(t,e,i,r){return-i*((t=t/r-1)*t*t*t-1)+e}function c(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e}function h(t,e,i,r){return i*(t/=r)*t*t*t*t+e}function l(t,e,i,r){return i*((t=t/r-1)*t*t*t*t+1)+e}function u(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e}function f(t,e,i,r){return-i*Math.cos(t/r*(Math.PI/2))+i+e}function d(t,e,i,r){return i*Math.sin(t/r*(Math.PI/2))+e}function p(t,e,i,r){return-i/2*(Math.cos(Math.PI*t/r)-1)+e}function g(t,e,i,r){return 0==t?e:i*Math.pow(2,10*(t/r-1))+e}function v(t,e,i,r){return t==r?e+i:i*(-Math.pow(2,-10*t/r)+1)+e}function b(t,e,i,r){return 0==t?e:t==r?e+i:(t/=r/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(-Math.pow(2,-10*--t)+2)+e}function m(t,e,i,r){return-i*(Math.sqrt(1-(t/=r)*t)-1)+e}function y(t,e,i,r){return i*Math.sqrt(1-(t=t/r-1)*t)+e}function x(t,e,i,r){return(t/=r/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e}function C(t,e,i,r){var n=1.70158,o=0,s=i;if(0==t)return e;if(1==(t/=r))return e+i;if(o||(o=.3*r),s<Math.abs(i)){s=i;var n=o/4}else var n=o/(2*Math.PI)*Math.asin(i/s);return-(s*Math.pow(2,10*(t-=1))*Math.sin((t*r-n)*(2*Math.PI)/o))+e}function w(t,e,i,r){var n=1.70158,o=0,s=i;if(0==t)return e;if(1==(t/=r))return e+i;if(o||(o=.3*r),s<Math.abs(i)){s=i;var n=o/4}else var n=o/(2*Math.PI)*Math.asin(i/s);return s*Math.pow(2,-10*t)*Math.sin((t*r-n)*(2*Math.PI)/o)+i+e}function S(t,e,i,r){var n=1.70158,o=0,s=i;if(0==t)return e;if(2==(t/=r/2))return e+i;if(o||(o=r*(.3*1.5)),s<Math.abs(i)){s=i;var n=o/4}else var n=o/(2*Math.PI)*Math.asin(i/s);return 1>t?-.5*(s*Math.pow(2,10*(t-=1))*Math.sin((t*r-n)*(2*Math.PI)/o))+e:s*Math.pow(2,-10*(t-=1))*Math.sin((t*r-n)*(2*Math.PI)/o)*.5+i+e}function _(t,e,i,r,n){return void 0==n&&(n=1.70158),i*(t/=r)*t*((n+1)*t-n)+e}function O(t,e,i,r,n){return void 0==n&&(n=1.70158),i*((t=t/r-1)*t*((n+1)*t+n)+1)+e}function j(t,e,i,r,n){return void 0==n&&(n=1.70158),(t/=r/2)<1?i/2*(t*t*(((n*=1.525)+1)*t-n))+e:i/2*((t-=2)*t*(((n*=1.525)+1)*t+n)+2)+e}function T(t,e,i,r){return i-A(r-t,0,i,r)+e}function A(t,e,i,r){return(t/=r)<1/2.75?i*(7.5625*t*t)+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}function k(t,e,i,r){return r/2>t?.5*T(2*t,0,i,r)+e:.5*A(2*t-r,0,i,r)+.5*i+e}fabric.util.ease={easeInQuad:t,easeOutQuad:e,easeInOutQuad:i,easeInCubic:r,easeOutCubic:n,easeInOutCubic:o,easeInQuart:s,easeOutQuart:a,easeInOutQuart:c,easeInQuint:h,easeOutQuint:l,easeInOutQuint:u,easeInSine:f,easeOutSine:d,easeInOutSine:p,easeInExpo:g,easeOutExpo:v,easeInOutExpo:b,easeInCirc:m,easeOutCirc:y,easeInOutCirc:x,easeInElastic:C,easeOutElastic:w,easeInOutElastic:S,easeInBack:_,easeOutBack:O,easeInOutBack:j,easeInBounce:T,easeOutBounce:A,easeInOutBounce:k}}(),function(t){"use strict";function e(t){return t in b?b[t]:t}function i(t,i){if(t){var r,n,o={};t.parentNode&&/^g$/i.test(t.parentNode.nodeName)&&(o=d.parseAttributes(t.parentNode,i));var s=i.reduce(function(i,o){return r=t.getAttribute(o),n=parseFloat(r),r&&("fill"!==o&&"stroke"!==o||"none"!==r||(r=""),"fill-rule"===o&&(r="evenodd"===r?"destination-over":r),"transform"===o&&(r=d.parseTransformAttribute(r)),o=e(o),i[o]=isNaN(n)?r:n),i},{});return s=p(s,p(c(t),d.parseStyleAttribute(t))),p(o,s)}}function r(t){if(!t)return null;t=t.trim();var e=t.indexOf(",")>-1;t=t.split(/\s+/);var i=[];if(e)for(var r=0,n=t.length;n>r;r++){var o=t[r].split(",");i.push({x:parseFloat(o[0]),y:parseFloat(o[1])})}else for(var r=0,n=t.length;n>r;r+=2)i.push({x:parseFloat(t[r]),y:parseFloat(t[r+1])});return i.length%2!==0,i}function n(t){var i={},r=t.getAttribute("style");if(r)if("string"==typeof r)r=r.replace(/;$/,"").split(";").forEach(function(t){var r=t.split(":");i[e(r[0].trim().toLowerCase())]=r[1].trim()});else for(var n in r)"undefined"!=typeof r[n]&&(i[e(n.toLowerCase())]=r[n]);return i}function o(t){for(var e=t.length;e--;){var i=t[e].get("fill");if(/^url\(/.test(i)){var r=i.slice(5,i.length-1);d.gradientDefs[r]&&t[e].set("fill",d.Gradient.fromElement(d.gradientDefs[r],t[e]))}}}function s(t,e,i,r){function n(){0===--c&&(a=a.filter(function(t){return null!=t}),o(a),e(a))}for(var s,a=Array(t.length),c=t.length,h=0,l=t.length;l>h;h++){s=t[h];var u=d[g(s.tagName)];if(u&&u.fromElement)try{if(u.async)u.fromElement(s,function(t,e){return function(i){r&&r(e,i),a.splice(t,0,i),n()}}(h),i);else{var f=u.fromElement(s,i);r&&r(s,f),a.splice(h,0,f),n()}}catch(p){d.log(p.message||p)}else n()}}function a(t){for(var e,i=t.getElementsByTagName("style"),r={},n=0,o=i.length;o>n;n++){var s=i[0].textContent;s=s.replace(/\/\*[\s\S]*?\*\//g,""),e=s.match(/[^{]*\{[\s\S]*?\}/g),e=e.map(function(t){return t.trim()}),e.forEach(function(t){var e=t.match(/([\s\S]*?)\s*\{([^}]*)\}/),t=e[1],i=e[2].trim(),n=i.replace(/;$/,"").split(/\s*;\s*/);r[t]||(r[t]={});for(var o=0,s=n.length;s>o;o++){var a=n[o].split(/\s*:\s*/),c=a[0],h=a[1];r[t][c]=h}})}return r}function c(t){var e=t.nodeName,i=t.getAttribute("class"),r=t.getAttribute("id"),n={};for(var o in d.cssRules){var s=i&&new RegExp("^\\."+i).test(o)||r&&new RegExp("^#"+r).test(o)||new RegExp("^"+e).test(o);if(s)for(var a in d.cssRules[o])n[a]=d.cssRules[o][a]}return n}function h(t,e,i){function r(r){var n=r.responseXML;!n.documentElement&&d.window.ActiveXObject&&r.responseText&&(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(r.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),n.documentElement&&d.parseSVGDocument(n.documentElement,function(i,r){m.set(t,{objects:d.util.array.invoke(i,"toObject"),options:r}),e(i,r)},i)}t=t.replace(/^\n\s*/,"").trim(),m.has(t,function(i){i?m.get(t,function(t){var i=l(t);e(i.objects,i.options)}):new d.util.request(t,{method:"get",onComplete:r})})}function l(t){var e=t.objects,i=t.options;return e=e.map(function(t){return d[g(t.type)].fromObject(t)}),{objects:e,options:i}}function u(t,e,i){t=t.trim();var r;if("undefined"!=typeof DOMParser){var n=new DOMParser;n&&n.parseFromString&&(r=n.parseFromString(t,"text/xml"))}else if(d.window.ActiveXObject){var r=new ActiveXObject("Microsoft.XMLDOM");r.async="false",r.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}d.parseSVGDocument(r.documentElement,function(t,i){e(t,i)},i)}function f(t){for(var e="",i=0,r=t.length;r>i;i++)"text"===t[i].type&&t[i].path&&(e+=["@font-face {","font-family: ",t[i].fontFamily,"; ","src: url('",t[i].path,"')","}"].join(""));return e&&(e=["<defs>",'<style type="text/css">',"<![CDATA[",e,"]]>","</style>","</defs>"].join("")),e}var d=t.fabric||(t.fabric={}),p=d.util.object.extend,g=d.util.string.capitalize,v=d.util.object.clone,b={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix","text-decoration":"textDecoration","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle","font-family":"fontFamily"};d.parseTransformAttribute=function(){function t(t,e){var i=e[0];t[0]=Math.cos(i),t[1]=Math.sin(i),t[2]=-Math.sin(i),t[3]=Math.cos(i)}function e(t,e){var i=e[0],r=2===e.length?e[1]:e[0];t[0]=i,t[3]=r}function i(t,e){t[2]=e[0]}function r(t,e){t[1]=e[0]}function n(t,e){t[4]=e[0],2===e.length&&(t[5]=e[1])}var o=[1,0,0,1,0,0],s="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",a="(?:\\s+,?\\s*|,\\s*)",c="(?:(skewX)\\s*\\(\\s*("+s+")\\s*\\))",h="(?:(skewY)\\s*\\(\\s*("+s+")\\s*\\))",l="(?:(rotate)\\s*\\(\\s*("+s+")(?:"+a+"("+s+")"+a+"("+s+"))?\\s*\\))",u="(?:(scale)\\s*\\(\\s*("+s+")(?:"+a+"("+s+"))?\\s*\\))",f="(?:(translate)\\s*\\(\\s*("+s+")(?:"+a+"("+s+"))?\\s*\\))",d="(?:(matrix)\\s*\\(\\s*("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")\\s*\\))",p="(?:"+d+"|"+f+"|"+u+"|"+l+"|"+c+"|"+h+")",g="(?:"+p+"(?:"+a+p+")*)",v="^\\s*(?:"+g+"?)\\s*$",b=new RegExp(v),m=new RegExp(p);return function(s){var a=o.concat();return!s||s&&!b.test(s)?a:(s.replace(m,function(o){var s=new RegExp(p).exec(o).filter(function(t){return""!==t&&null!=t}),c=s[1],h=s.slice(2).map(parseFloat);switch(c){case"translate":n(a,h);break;case"rotate":t(a,h);break;case"scale":e(a,h);break;case"skewX":i(a,h);break;case"skewY":r(a,h);break;case"matrix":a=h}}),a)}}(),d.parseSVGDocument=function(){function t(t,e){for(;t&&(t=t.parentNode);)if(e.test(t.nodeName))return!0;return!1}var e=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,i="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",r=new RegExp("^\\s*("+i+"+)\\s*,?\\s*("+i+"+)\\s*,?\\s*("+i+"+)\\s*,?\\s*("+i+"+)\\s*$");return function(i,n,o){if(i){var s=new Date,c=d.util.toArray(i.getElementsByTagName("*"));if(0===c.length){c=i.selectNodes("//*[name(.)!='svg']");for(var h=[],l=0,u=c.length;u>l;l++)h[l]=c[l];c=h}var f=c.filter(function(i){return e.test(i.tagName)&&!t(i,/^(?:pattern|defs)$/)});if(f&&(!f||f.length)){var p,g,b=i.getAttribute("viewBox"),m=i.getAttribute("width"),y=i.getAttribute("height"),x=null,C=null;b&&(b=b.match(r))&&(p=parseInt(b[1],10),g=parseInt(b[2],10),x=parseInt(b[3],10),C=parseInt(b[4],10)),x=m?parseFloat(m):x,C=y?parseFloat(y):C;var w={width:x,height:C};d.gradientDefs=d.getGradientDefs(i),d.cssRules=a(i),d.parseElements(f,function(t){d.documentParsingTime=new Date-s,n&&n(t,w)},v(w),o)}}}}();var m={has:function(t,e){e(!1)},get:function(t,e){},set:function(t,e){}};p(d,{parseAttributes:i,parseElements:s,parseStyleAttribute:n,parsePointsAttribute:r,getCSSRules:a,loadSVGFromURL:h,loadSVGFromString:u,createSVGFontFacesMarkup:f})}("undefined"!=typeof exports?exports:this),function(){function t(t){var e=t.getAttribute("style");if(e){var i=e.split(/\s*;\s*/);""===i[i.length-1]&&i.pop();for(var r=i.length;r--;){var n=i[r].split(/\s*:\s*/),o=n[0].trim(),s=n[1].trim();if("stop-color"===o)return s}}}function e(t,e){for(var i in e){if("string"==typeof e[i]&&/^\d+%$/.test(e[i])){var r=parseFloat(e[i],10);"x1"===i||"x2"===i?e[i]=t.width*r/100:"y1"!==i&&"y2"!==i||(e[i]=t.height*r/100)}"x1"===i||"x2"===i?e[i]-=t.width/2:"y1"!==i&&"y2"!==i||(e[i]-=t.height/2)}}function i(t){for(var e,i=t.getElementsByTagName("linearGradient"),r=t.getElementsByTagName("radialGradient"),n={},o=i.length;o--;)e=i[o],n[e.getAttribute("id")]=e;for(var o=r.length;o--;)e=r[o],n[e.getAttribute("id")]=e;return n}fabric.Gradient=fabric.util.createClass({initialize:function(t){t||(t={}),this.x1=t.x1||0,this.y1=t.y1||0,this.x2=t.x2||0,this.y2=t.y2||0,this.colorStops=t.colorStops},toObject:function(){return{x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2,colorStops:this.colorStops}},toLiveGradient:function(t){var e=t.createLinearGradient(this.x1,this.y1,this.x2||t.canvas.width,this.y2);for(var i in this.colorStops){var r=this.colorStops[i];e.addColorStop(parseFloat(i),r)}return e}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(i,r){for(var i,n,o=i.getElementsByTagName("stop"),s={},a={x1:i.getAttribute("x1")||0,y1:i.getAttribute("y1")||0,x2:i.getAttribute("x2")||"100%",y2:i.getAttribute("y2")||0},c=o.length;c--;)i=o[c],n=i.getAttribute("offset"),n=parseFloat(n)/(/%$/.test(n)?100:1),s[n]=t(i)||i.getAttribute("stop-color");return e(r,a),new fabric.Gradient({x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,colorStops:s})},forObject:function(t,i){return i||(i={}),e(t,i),new fabric.Gradient(i)}}),fabric.getGradientDefs=i}(),function(t){"use strict";function e(t,e){arguments.length>0&&this.init(t,e)}var i=t.fabric||(t.fabric={});return i.Point?void i.warn("fabric.Point is already defined"):(i.Point=e,void(e.prototype={constructor:e,init:function(t,e){this.x=t,this.y=e},add:function(t){return new e(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new e(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new e(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new e(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new e(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new e(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x==t.x&&this.y==t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,i){return new e(this.x+(t.x-this.x)*i,this.y+(t.y-this.y)*i)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},min:function(t){return new e(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new e(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){this.x=t,this.y=e},setFromPoint:function(t){this.x=t.x,this.y=t.y},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i}}))}("undefined"!=typeof exports?exports:this),function(t){"use strict";function e(t){arguments.length>0&&this.init(t)}var i=t.fabric||(t.fabric={});return i.Intersection?void i.warn("fabric.Intersection is already defined"):(i.Intersection=e,i.Intersection.prototype={init:function(t){this.status=t,this.points=[]},appendPoint:function(t){this.points.push(t)},appendPoints:function(t){this.points=this.points.concat(t)}},i.Intersection.intersectLineLine=function(t,r,n,o){var s,a=(o.x-n.x)*(t.y-n.y)-(o.y-n.y)*(t.x-n.x),c=(r.x-t.x)*(t.y-n.y)-(r.y-t.y)*(t.x-n.x),h=(o.y-n.y)*(r.x-t.x)-(o.x-n.x)*(r.y-t.y);if(0!=h){var l=a/h,u=c/h;l>=0&&1>=l&&u>=0&&1>=u?(s=new e("Intersection"),s.points.push(new i.Point(t.x+l*(r.x-t.x),t.y+l*(r.y-t.y)))):s=new e("No Intersection")}else s=new e(0==a||0==c?"Coincident":"Parallel");return s},i.Intersection.intersectLinePolygon=function(t,i,r){for(var n=new e("No Intersection"),o=r.length,s=0;o>s;s++){var a=r[s],c=r[(s+1)%o],h=e.intersectLineLine(t,i,a,c);n.appendPoints(h.points)}return n.points.length>0&&(n.status="Intersection"),n},i.Intersection.intersectPolygonPolygon=function(t,i){for(var r=new e("No Intersection"),n=t.length,o=0;n>o;o++){var s=t[o],a=t[(o+1)%n],c=e.intersectLinePolygon(s,a,i);r.appendPoints(c.points)}return r.points.length>0&&(r.status="Intersection"),r},void(i.Intersection.intersectPolygonRectangle=function(t,r,n){var o=r.min(n),s=r.max(n),a=new i.Point(s.x,o.y),c=new i.Point(o.x,s.y),h=e.intersectLinePolygon(o,a,t),l=e.intersectLinePolygon(a,s,t),u=e.intersectLinePolygon(s,c,t),f=e.intersectLinePolygon(c,o,t),d=new e("No Intersection");return d.appendPoints(h.points),d.appendPoints(l.points),d.appendPoints(u.points),d.appendPoints(f.points),d.points.length>0&&(d.status="Intersection"),d}))}("undefined"!=typeof exports?exports:this),function(t){"use strict";function e(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}var i=t.fabric||(t.fabric={});return i.Color?void i.warn("fabric.Color is already defined."):(i.Color=e,i.Color.prototype={_tryParsingColor:function(t){var i=e.sourceFromHex(t);i||(i=e.sourceFromRgb(t)),i&&this.setSource(i)},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHex:function(){var t=this.getSource(),e=t[0].toString(16);e=1==e.length?"0"+e:e;var i=t[1].toString(16);i=1==i.length?"0"+i:i;var r=t[2].toString(16);return r=1==r.length?"0"+r:r,e.toUpperCase()+i.toUpperCase()+r.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),r=e[3],t=t||127;return i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,r]),this},overlayWith:function(t){t instanceof e||(t=new e(t));for(var i=[],r=this.getAlpha(),n=.5,o=this.getSource(),s=t.getSource(),a=0;3>a;a++)i.push(Math.round(o[a]*(1-n)+s[a]*n));return i[3]=r,this.setSource(i),this}},i.Color.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/,i.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,i.Color.fromRgb=function(t){return e.fromSource(e.sourceFromRgb(t))},i.Color.sourceFromRgb=function(t){var i=t.match(e.reRGBa);return i?[parseInt(i[1],10),parseInt(i[2],10),parseInt(i[3],10),i[4]?parseFloat(i[4]):1]:void 0},i.Color.fromRgba=e.fromRgb,i.Color.fromHex=function(t){return e.fromSource(e.sourceFromHex(t))},i.Color.sourceFromHex=function(t){if(t.match(e.reHex)){var i=t.slice(t.indexOf("#")+1),r=3===i.length,n=r?i.charAt(0)+i.charAt(0):i.substring(0,2),o=r?i.charAt(1)+i.charAt(1):i.substring(2,4),s=r?i.charAt(2)+i.charAt(2):i.substring(4,6);return[parseInt(n,16),parseInt(o,16),parseInt(s,16),1]}},void(i.Color.fromSource=function(t){var i=new e;return i.setSource(t),i}))}("undefined"!=typeof exports?exports:this),function(t){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var e=fabric.util.object.extend,i=fabric.util.getElementOffset,r=fabric.util.removeFromArray,n=fabric.util.removeListener,o=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=function(t,e){e||(e={}),this._initStatic(t,e),fabric.StaticCanvas.activeInstance=this},e(fabric.StaticCanvas.prototype,fabric.Observable),e(fabric.StaticCanvas.prototype,{backgroundColor:"rgba(0, 0, 0, 0)",backgroundImage:"",backgroundImageOpacity:1,backgroundImageStretch:!0,includeDefaultValues:!0,stateful:!0,renderOnAddition:!0,clipTo:null,controlsAboveOverlay:!1,onBeforeScaleRotate:function(t){},onFpsUpdate:null,_initStatic:function(t,e){this._objects=[],this._createLowerCanvas(t),this._initOptions(e),e.overlayImage&&this.setOverlayImage(e.overlayImage,this.renderAll.bind(this)),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,this.renderAll.bind(this)),this.calcOffset()},calcOffset:function(){return this._offset=i(this.lowerCanvasEl),this},setOverlayImage:function(t,e){return fabric.util.loadImage(t,function(t){this.overlayImage=t,e&&e()},this),this},setBackgroundImage:function(t,e,i){return fabric.util.loadImage(t,function(t){this.backgroundImage=t,i&&"backgroundImageOpacity"in i&&(this.backgroundImageOpacity=i.backgroundImageOpacity),i&&"backgroundImageStretch"in i&&(this.backgroundImageStretch=i.backgroundImageStretch),e&&e()},this)},_createCanvasElement:function(){var t=fabric.document.createElement("canvas");if(t.style||(t.style={}),!t)throw o;return this._initCanvasElement(t),t},_initCanvasElement:function(t){if("undefined"==typeof t.getContext&&"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement&&G_vmlCanvasManager.initElement(t),"undefined"==typeof t.getContext)throw o},_initOptions:function(t){for(var e in t)this[e]=t[e];this.width=parseInt(this.lowerCanvasEl.width,10)||0,this.height=parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px")},_createLowerCanvas:function(t){this.lowerCanvasEl=fabric.util.getById(t)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t){return this._setDimension("width",t)},setHeight:function(t){return this._setDimension("height",t)},setDimensions:function(t){for(var e in t)this._setDimension(e,t[e]);return this},_setDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.lowerCanvasEl.style[t]=e+"px",this.upperCanvasEl&&(this.upperCanvasEl[t]=e,this.upperCanvasEl.style[t]=e+"px"),this.wrapperEl&&(this.wrapperEl.style[t]=e+"px"),this[t]=e,this.calcOffset(),this.renderAll(),this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(t,e){if(e)if(this.controlsAboveOverlay){var i=e.hasBorders,r=e.hasCorners;e.hasBorders=e.hasCorners=!1,e.render(t),e.hasBorders=i,e.hasCorners=r}else e.render(t)},add:function(){this._objects.push.apply(this._objects,arguments);for(var t=arguments.length;t--;)this._initObject(arguments[t]);return this.renderOnAddition&&this.renderAll(),this},_initObject:function(t){this.stateful&&t.setupState(),t.setCoords(),t.canvas=this,this.fire("object:added",{target:t}),t.fire("added")},insertAt:function(t,e,i){return i?this._objects[e]=t:this._objects.splice(e,0,t),this._initObject(t),this.renderOnAddition&&this.renderAll(),this},getObjects:function(){return this._objects},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),this},renderAll:function(t){var e=this[t===!0&&this.interactive?"contextTop":"contextContainer"];this.contextTop&&this.clearContext(this.contextTop),t!==!1&&"undefined"!=typeof t||this.clearContext(e);var i=this._objects.length,r=this.getActiveGroup(),n=new Date;if(this.clipTo&&(e.save(),e.beginPath(),this.clipTo(e),e.clip()),e.fillStyle=this.backgroundColor,e.fillRect(0,0,this.width,this.height),"object"==typeof this.backgroundImage&&(e.save(),e.globalAlpha=this.backgroundImageOpacity,this.backgroundImageStretch?e.drawImage(this.backgroundImage,0,0,this.width,this.height):e.drawImage(this.backgroundImage,0,0),e.restore()),i)for(var o=0;i>o;++o)(!r||r&&this._objects[o]&&!r.contains(this._objects[o]))&&this._draw(e,this._objects[o]);if(this.clipTo&&e.restore(),r&&this._draw(this.contextTop,r),this.overlayImage&&this.contextContainer.drawImage(this.overlayImage,0,0),this.controlsAboveOverlay&&this.drawControls(this.contextContainer),this.onFpsUpdate){var s=new Date-n;this.onFpsUpdate(~~(1e3/s))}return this.fire("after:render"),this},renderTop:function(){this.clearContext(this.contextTop||this.contextContainer),this.overlayImage&&this.contextContainer.drawImage(this.overlayImage,0,0),this.selection&&this._groupSelector&&this._drawSelection();var t=this.getActiveGroup();return t&&t.render(this.contextTop),this.fire("after:render"),this},drawControls:function(t){var e=this.getActiveGroup();if(e)t.save(),fabric.Group.prototype.transform.call(e,t),e.drawBorders(t).drawCorners(t),t.restore();else for(var i=0,r=this._objects.length;r>i;++i)this._objects[i].active&&(t.save(),fabric.Object.prototype.transform.call(this._objects[i],t),this._objects[i].drawBorders(t).drawCorners(t),t.restore())},toDataURL:function(t,e){var i=this.upperCanvasEl||this.lowerCanvasEl;this.renderAll(!0);var r=fabric.StaticCanvas.supports("toDataURLWithQuality")?i.toDataURL("image/"+t,e):i.toDataURL("image/"+t);return this.renderAll(),r},toDataURLWithMultiplier:function(t,e,i){var r=this.getWidth(),n=this.getHeight(),o=r*e,s=n*e,a=this.getActiveObject(),c=this.getActiveGroup();this.setWidth(o).setHeight(s),this.contextTop.scale(e,e),c?this._tempRemoveBordersCornersFromGroup(c):a&&this.deactivateAll(),this.width=r,this.height=n,this.renderAll(!0);var h=this.toDataURL(t,i);return this.contextTop.scale(1/e,1/e),this.setWidth(r).setHeight(n),c?this._restoreBordersCornersOnGroup(c):a&&this.setActiveObject(a),this.renderAll(),h},_tempRemoveBordersCornersFromGroup:function(t){t.origHideCorners=t.hideCorners,t.origBorderColor=t.borderColor,t.hideCorners=!0,t.borderColor="rgba(0,0,0,0)",t.forEachObject(function(t){t.origBorderColor=t.borderColor,t.borderColor="rgba(0,0,0,0)"})},_restoreBordersCornersOnGroup:function(t){t.hideCorners=t.origHideCorners,t.borderColor=t.origBorderColor,t.forEachObject(function(t){t.borderColor=t.origBorderColor,delete t.origBorderColor})},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(t){return t.set("left",this.getCenter().left),this.renderAll(),this},centerObjectV:function(t){return t.set("top",this.getCenter().top),this.renderAll(),this},centerObject:function(t){return this.centerObjectH(t).centerObjectV(t)},toDatalessJSON:function(){return this.toDatalessObject()},toObject:function(){return this._toObjectMethod("toObject")},toDatalessObject:function(){return this._toObjectMethod("toDatalessObject")},_toObjectMethod:function(t){var e={objects:this._objects.map(function(e){if(!this.includeDefaultValues){var i=e.includeDefaultValues;e.includeDefaultValues=!1}var r=e[t]();return this.includeDefaultValues||(e.includeDefaultValues=i),r},this),background:this.backgroundColor};return this.backgroundImage&&(e.backgroundImage=this.backgroundImage.src,e.backgroundImageOpacity=this.backgroundImageOpacity,e.backgroundImageStretch=this.backgroundImageStretch),e},toSVG:function(){var t=['<?xml version="1.0" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" ','"http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">',"<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',this.width,'" ','height="',this.height,'" ','xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>",fabric.createSVGFontFacesMarkup(this.getObjects())];this.backgroundImage&&t.push('<image x="0" y="0" ','width="',this.width,'" height="',this.height,'" preserveAspectRatio="',this.backgroundImageStretch?"none":"defer",'" xlink:href="',this.backgroundImage.src,'" style="opacity:',this.backgroundImageOpacity,'"></image>');for(var e=0,i=this.getObjects(),r=i.length;r>e;e++)t.push(i[e].toSVG());return t.push("</svg>"),t.join("")},isEmpty:function(){return 0===this._objects.length},remove:function(t){return r(this._objects,t),this.getActiveObject()===t&&(this.fire("before:selection:cleared",{target:t}),this.discardActiveObject(),this.fire("selection:cleared")),this.renderAll(),t},sendToBack:function(t){return r(this._objects,t),this._objects.unshift(t),this.renderAll()},bringToFront:function(t){return r(this._objects,t),this._objects.push(t),this.renderAll()},sendBackwards:function(t){var e=this._objects.indexOf(t),i=e;if(0!==e){for(var n=e-1;n>=0;--n)if(t.intersectsWithObject(this._objects[n])||t.isContainedWithinObject(this._objects[n])){i=n;break}r(this._objects,t),this._objects.splice(i,0,t)}return this.renderAll()},bringForward:function(t){var e=this.getObjects(),i=e.indexOf(t),n=i;if(i!==e.length-1){for(var o=i+1,s=this._objects.length;s>o;++o)if(t.intersectsWithObject(e[o])||t.isContainedWithinObject(this._objects[o])){n=o;break}r(e,t),e.splice(n,0,t)}this.renderAll()},item:function(t){return this.getObjects()[t]},complexity:function(){return this.getObjects().reduce(function(t,e){return t+=e.complexity?e.complexity():0},0)},forEachObject:function(t,e){for(var i=this.getObjects(),r=i.length;r--;)t.call(e,i[r],r,i);return this},dispose:function(){return this.clear(),this.interactive&&(n(this.upperCanvasEl,"mousedown",this._onMouseDown),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(fabric.window,"resize",this._onResize)),this},_resizeImageToFit:function(t){var e=t.width||t.offsetWidth,i=this.getWidth()/e;e&&(t.width=e*i)}}),fabric.StaticCanvas.prototype.toString=function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"},e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(t){var e,i,r,n,o=t.getContext("2d"),s=o.getImageData(0,0,t.width,t.height),a=s.data,c=s.width,h=s.height;for(r=0;c>r;r++)for(n=0;h>n;n++)e=4*r*h+4*n,i=(a[e]+a[e+1]+a[e+2])/3,a[e]=i,a[e+1]=i,a[e+2]=i;o.putImageData(s,0,0)},supports:function(t){var e=fabric.document.createElement("canvas");if("undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(e),!e||!e.getContext)return null;var i=e.getContext("2d");if(!i)return null;switch(t){case"getImageData":return"undefined"!=typeof i.getImageData;case"toDataURL":return"undefined"!=typeof e.toDataURL;case"toDataURLWithQuality":try{return e.toDataURL("image/jpeg",0),!0}catch(r){return!1}default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}("undefined"!=typeof exports?exports:this),function(){function t(){}var e=fabric.util.object.extend,i=fabric.util.getPointer,r=fabric.util.addListener,n=fabric.util.removeListener,o={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"},s=fabric.util.array.min,a=fabric.util.array.max,c=Math.sqrt,h=Math.pow,l=Math.atan2,u=Math.abs,f=Math.min,d=Math.max,p=.5;fabric.Canvas=function(t,e){e||(e={}),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas(),fabric.Canvas.activeInstance=this},t.prototype=fabric.StaticCanvas.prototype,fabric.Canvas.prototype=new t;var g={interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,freeDrawingColor:"rgb(0, 0, 0)",freeDrawingLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._freeDrawingXPoints=[],this._freeDrawingYPoints=[],this._initWrapperElement(),this._createUpperCanvas(),this._initEvents(),this.calcOffset()},_initEvents:function(){var t=this;this._onMouseDown=function(e){t.__onMouseDown(e),r(fabric.document,"mouseup",t._onMouseUp),fabric.isTouchSupported&&r(fabric.document,"touchend",t._onMouseUp),r(fabric.document,"mousemove",t._onMouseMove),fabric.isTouchSupported&&r(fabric.document,"touchmove",t._onMouseMove),
n(t.upperCanvasEl,"mousemove",t._onMouseMove),fabric.isTouchSupported&&n(t.upperCanvasEl,"touchmove",t._onMouseMove)},this._onMouseUp=function(e){t.__onMouseUp(e),n(fabric.document,"mouseup",t._onMouseUp),fabric.isTouchSupported&&n(fabric.document,"touchend",t._onMouseUp),n(fabric.document,"mousemove",t._onMouseMove),fabric.isTouchSupported&&n(fabric.document,"touchmove",t._onMouseMove),r(t.upperCanvasEl,"mousemove",t._onMouseMove),fabric.isTouchSupported&&r(t.upperCanvasEl,"touchmove",t._onMouseMove)},this._onMouseMove=function(e){e.preventDefault&&e.preventDefault(),t.__onMouseMove(e)},this._onResize=function(e){t.calcOffset()},r(fabric.window,"resize",this._onResize),fabric.isTouchSupported?(r(this.upperCanvasEl,"touchstart",this._onMouseDown),r(this.upperCanvasEl,"touchmove",this._onMouseMove)):(r(this.upperCanvasEl,"mousedown",this._onMouseDown),r(this.upperCanvasEl,"mousemove",this._onMouseMove))},__onMouseUp:function(t){if(this.isDrawingMode&&this._isCurrentlyDrawing)return this._finalizeDrawingPath(),void this.fire("mouse:up",{e:t});if(this._currentTransform){var e=this._currentTransform,i=e.target;i._scaling&&(i._scaling=!1);for(var r=this._objects.length;r--;)this._objects[r].setCoords();this.stateful&&i.hasStateChanged()&&(i.isMoving=!1,this.fire("object:modified",{target:i}),i.fire("modified"))}this._currentTransform=null,this._groupSelector&&this._findSelectedObjects(t);var n=this.getActiveGroup();n&&(n.setObjectsCoords(),n.set("isMoving",!1),this._setCursor(this.defaultCursor)),this._groupSelector=null,this.renderAll(),this._setCursorFromEvent(t,i),this._setCursor("");var o=this;setTimeout(function(){o._setCursorFromEvent(t,i)},50),this.fire("mouse:up",{target:i,e:t}),i&&i.fire("mouseup",{e:t})},__onMouseDown:function(t){var e="which"in t?1==t.which:1==t.button;if(e||fabric.isTouchSupported){if(this.isDrawingMode)return this._prepareForDrawing(t),this._captureDrawingPath(t),void this.fire("mouse:down",{e:t});if(!this._currentTransform){var i,r=this.findTarget(t),n=this.getPointer(t),o=this.getActiveGroup();if(this._shouldClearSelection(t))this._groupSelector={ex:n.x,ey:n.y,top:0,left:0},this.deactivateAllWithDispatch();else{this.stateful&&r.saveState(),(i=r._findTargetCorner(t,this._offset))&&this.onBeforeScaleRotate(r),this._setupCurrentTransform(t,r);var s=t.shiftKey&&(o||this.getActiveObject())&&this.selection;s?this._handleGroupLogic(t,r):(r!==this.getActiveGroup()&&this.deactivateAll(),this.setActiveObject(r,t))}this.renderAll(),this.fire("mouse:down",{target:r,e:t}),r&&r.fire("mousedown",{e:t})}}},__onMouseMove:function(t){if(this.isDrawingMode)return this._isCurrentlyDrawing&&this._captureDrawingPath(t),void this.fire("mouse:move",{e:t});var e=this._groupSelector;if(null!==e){var r=i(t);e.left=r.x-this._offset.left-e.ex,e.top=r.y-this._offset.top-e.ey,this.renderTop()}else if(this._currentTransform){var r=i(t),n=r.x,o=r.y;this._currentTransform.target.isMoving=!0,"rotate"===this._currentTransform.action?(t.shiftKey||(this._rotateObject(n,o),this.fire("object:rotating",{target:this._currentTransform.target}),this._currentTransform.target.fire("rotating")),this._currentTransform.target.hasRotatingPoint||(this._scaleObject(n,o),this.fire("object:scaling",{target:this._currentTransform.target}),this._currentTransform.target.fire("scaling"))):"scale"===this._currentTransform.action?(this._scaleObject(n,o),this.fire("object:scaling",{target:this._currentTransform.target}),this._currentTransform.target.fire("scaling")):"scaleX"===this._currentTransform.action?(this._scaleObject(n,o,"x"),this.fire("object:scaling",{target:this._currentTransform.target}),this._currentTransform.target.fire("scaling")):"scaleY"===this._currentTransform.action?(this._scaleObject(n,o,"y"),this.fire("object:scaling",{target:this._currentTransform.target}),this._currentTransform.target.fire("scaling")):(this._translateObject(n,o),this.fire("object:moving",{target:this._currentTransform.target}),this._setCursor(this.moveCursor),this._currentTransform.target.fire("moving")),this.renderAll()}else{var s=this.upperCanvasEl.style,a=this.findTarget(t);if(a)this._setCursorFromEvent(t,a),a.isActive()&&a.setCornersVisibility&&a.setCornersVisibility(!0);else{for(var c=this._objects.length;c--;)this._objects[c]&&!this._objects[c].active&&this._objects[c].setActive(!1);s.cursor=this.defaultCursor}}this.fire("mouse:move",{target:a,e:t}),a&&a.fire("mousemove",{e:t})},containsPoint:function(t,e){var i=this.getPointer(t),r=this._normalizePointer(e,i),n=r.x,o=r.y,s=e._getImageLines(e.oCoords),a=e._findCrossPoints(n,o,s);return!!(a&&a%2===1||e._findTargetCorner(t,this._offset))},_normalizePointer:function(t,e){var i=this.getActiveGroup(),r=e.x,n=e.y,o=i&&"group"!==t.type&&i.contains(t);return o&&(r-=i.left,n-=i.top),{x:r,y:n}},_isTargetTransparent:function(t,e,i){var r=this.contextCache,n=t.hasBorders,o=t.transparentCorners;t.hasBorders=t.transparentCorners=!1,this._draw(r,t),t.hasBorders=n,t.transparentCorners=o,this.targetFindTolerance>0&&(e>this.targetFindTolerance?e-=this.targetFindTolerance:e=0,i>this.targetFindTolerance?i-=this.targetFindTolerance:i=0);for(var s=!0,a=r.getImageData(e,i,2*this.targetFindTolerance||1,2*this.targetFindTolerance||1),c=3;c<a.data.length;c+=4){var h=a.data[c];if(s=0>=h,s===!1)break}return a=null,this.clearContext(r),s},_shouldClearSelection:function(t){var e=this.findTarget(t),i=this.getActiveGroup();return!e||e&&i&&!i.contains(e)&&i!==e&&!t.shiftKey},_setupCurrentTransform:function(t,e){var r,n="drag",o=i(t);(r=e._findTargetCorner(t,this._offset))&&(n="ml"===r||"mr"===r?"scaleX":"mt"===r||"mb"===r?"scaleY":"mtr"===r?"rotate":e.hasRotatingPoint?"scale":"rotate"),this._currentTransform={target:e,action:n,scaleX:e.scaleX,scaleY:e.scaleY,offsetX:o.x-e.left,offsetY:o.y-e.top,ex:o.x,ey:o.y,left:e.left,top:e.top,theta:e._theta,width:e.width*e.scaleX},this._currentTransform.original={left:e.left,top:e.top}},_handleGroupLogic:function(t,e){if(e!==this.getActiveGroup()||(e=this.findTarget(t,!0),e&&!e.isType("group"))){var i=this.getActiveGroup();if(i)i.contains(e)?(i.removeWithUpdate(e),e.setActive(!1),1===i.size()&&this.discardActiveGroup()):i.addWithUpdate(e),this.fire("selection:created",{target:i,e:t}),i.setActive(!0);else{if(this._activeObject&&e!==this._activeObject){var r=new fabric.Group([this._activeObject,e]);this.setActiveGroup(r),i=this.getActiveGroup()}e.setActive(!0)}i&&i.saveCoords()}},_prepareForDrawing:function(t){this._isCurrentlyDrawing=!0,this.discardActiveObject().renderAll();var e=this.getPointer(t);this._freeDrawingXPoints.length=this._freeDrawingYPoints.length=0,this._freeDrawingXPoints.push(e.x),this._freeDrawingYPoints.push(e.y),this.contextTop.beginPath(),this.contextTop.moveTo(e.x,e.y),this.contextTop.strokeStyle=this.freeDrawingColor,this.contextTop.lineWidth=this.freeDrawingLineWidth,this.contextTop.lineCap=this.contextTop.lineJoin="round"},_captureDrawingPath:function(t){var e=this.getPointer(t);this._freeDrawingXPoints.push(e.x),this._freeDrawingYPoints.push(e.y),this.contextTop.lineTo(e.x,e.y),this.contextTop.stroke()},_finalizeDrawingPath:function(){this.contextTop.closePath(),this._isCurrentlyDrawing=!1;var t,e,i=s(this._freeDrawingXPoints),r=s(this._freeDrawingYPoints),n=a(this._freeDrawingXPoints),o=a(this._freeDrawingYPoints),c=(this.contextTop,[]),h=this._freeDrawingXPoints,l=this._freeDrawingYPoints;c.push("M ",h[0]-i," ",l[0]-r," ");for(var u=1;t=h[u],e=l[u];u++)c.push("L ",t-i," ",e-r," ");if(c=c.join(""),"M 0 0 L 0 0 "===c)return void this.renderAll();var f=new fabric.Path(c);f.fill=null,f.stroke=this.freeDrawingColor,f.strokeWidth=this.freeDrawingLineWidth,this.add(f),f.set("left",i+(n-i)/2).set("top",r+(o-r)/2).setCoords(),this.renderAll(),this.fire("path:created",{path:f})},_translateObject:function(t,e){var i=this._currentTransform.target;i.lockMovementX||i.set("left",t-this._currentTransform.offsetX),i.lockMovementY||i.set("top",e-this._currentTransform.offsetY)},_scaleObject:function(t,e,i){var r=this._currentTransform,n=this._offset,o=r.target;if(!o.lockScalingX||!o.lockScalingY){var s=c(h(r.ey-r.top-n.top,2)+h(r.ex-r.left-n.left,2)),a=c(h(e-r.top-n.top,2)+h(t-r.left-n.left,2));o._scaling=!0,i?"x"!==i||o.lockUniScaling?"y"!==i||o.lockUniScaling||o.lockScalingY||o.set("scaleY",r.scaleY*a/s):o.lockScalingX||o.set("scaleX",r.scaleX*a/s):(o.lockScalingX||o.set("scaleX",r.scaleX*a/s),o.lockScalingY||o.set("scaleY",r.scaleY*a/s))}},_rotateObject:function(t,e){var i=this._currentTransform,r=this._offset;if(!i.target.lockRotation){var n=l(i.ey-i.top-r.top,i.ex-i.left-r.left),o=l(e-i.top-r.top,t-i.left-r.left);i.target._theta=o-n+i.theta}},_setCursor:function(t){this.upperCanvasEl.style.cursor=t},_setCursorFromEvent:function(t,e){var i=this.upperCanvasEl.style;if(!e)return i.cursor=this.defaultCursor,!1;var r=this.getActiveGroup(),n=!!e._findTargetCorner&&(!r||!r.contains(e))&&e._findTargetCorner(t,this._offset);if(n)if(n in o)i.cursor=o[n];else{if("mtr"!==n||!e.hasRotatingPoint)return i.cursor=this.defaultCursor,!1;i.cursor=this.rotationCursor}else i.cursor=this.hoverCursor;return!0},_drawSelection:function(){var t=this._groupSelector,e=t.left,i=t.top,r=u(e),n=u(i);this.contextTop.fillStyle=this.selectionColor,this.contextTop.fillRect(t.ex-(e>0?0:-e),t.ey-(i>0?0:-i),r,n),this.contextTop.lineWidth=this.selectionLineWidth,this.contextTop.strokeStyle=this.selectionBorderColor,this.contextTop.strokeRect(t.ex+p-(e>0?0:r),t.ey+p-(i>0?0:n),r,n)},_findSelectedObjects:function(t){for(var e,i=[],r=this._groupSelector.ex,n=this._groupSelector.ey,o=r+this._groupSelector.left,s=n+this._groupSelector.top,a=new fabric.Point(f(r,o),f(n,s)),c=new fabric.Point(d(r,o),d(n,s)),h=0,l=this._objects.length;l>h;++h)e=this._objects[h],e&&(e.intersectsWithRect(a,c)||e.isContainedWithinRect(a,c))&&this.selection&&e.selectable&&(e.setActive(!0),i.push(e));if(1===i.length)this.setActiveObject(i[0],t);else if(i.length>1){var i=new fabric.Group(i);this.setActiveGroup(i),i.saveCoords(),this.fire("selection:created",{target:i})}this.renderAll()},findTarget:function(t,e){var i,r=this.getPointer(t),n=this.getActiveGroup();if(n&&!e&&this.containsPoint(t,n))return i=n;for(var o=[],s=this._objects.length;s--;)if(this._objects[s]&&this.containsPoint(t,this._objects[s])){if(!this.perPixelTargetFind&&!this._objects[s].perPixelTargetFind){i=this._objects[s],this.relatedTarget=i;break}o[o.length]=this._objects[s]}for(var s=0,a=o.length;a>s;s++){var r=this.getPointer(t),c=this._isTargetTransparent(o[s],r.x,r.y);if(!c){i=o[s],this.relatedTarget=i;break}}return i&&i.selectable?i:void 0},getPointer:function(t){var e=i(t);return{x:e.x-this._offset.left,y:e.y-this._offset.top}},_createUpperCanvas:function(){this.upperCanvasEl=this._createCanvasElement(),this.upperCanvasEl.className="upper-canvas",this.wrapperEl.appendChild(this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.getWidth()||t.width,i=this.getHeight()||t.height;fabric.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0}),t.width=e,t.height=i,fabric.util.makeElementUnselectable(t)},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},setActiveObject:function(t,e){return this._activeObject&&this._activeObject.setActive(!1),this._activeObject=t,t.setActive(!0),this.renderAll(),this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e}),this},getActiveObject:function(){return this._activeObject},discardActiveObject:function(){return this._activeObject&&this._activeObject.setActive(!1),this._activeObject=null,this},setActiveGroup:function(t){return this._activeGroup=t,t&&t.setActive(!0),this},getActiveGroup:function(){return this._activeGroup},discardActiveGroup:function(){var t=this.getActiveGroup();return t&&t.destroy(),this.setActiveGroup(null)},deactivateAll:function(){for(var t=this.getObjects(),e=0,i=t.length;i>e;e++)t[e].setActive(!1);return this.discardActiveGroup(),this.discardActiveObject(),this},deactivateAllWithDispatch:function(){var t=this.getActiveGroup()||this.getActiveObject();return t&&this.fire("before:selection:cleared",{target:t}),this.deactivateAll(),t&&this.fire("selection:cleared"),this}};fabric.Canvas.prototype.toString=fabric.StaticCanvas.prototype.toString,e(fabric.Canvas.prototype,g);for(var v in fabric.StaticCanvas)"prototype"!==v&&(fabric.Canvas[v]=fabric.StaticCanvas[v]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,e){e=e||{};var i=function(){},r=e.onComplete||i,n=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(e){t.set("left",e),o.renderAll(),n()},onComplete:function(){t.setCoords(),r()}}),this},fxCenterObjectV:function(t,e){e=e||{};var i=function(){},r=e.onComplete||i,n=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(e){t.set("top",e),o.renderAll(),n()},onComplete:function(){t.setCoords(),r()}}),this},fxRemove:function(t,e){e=e||{};var i=function(){},r=e.onComplete||i,n=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){t.setActive(!1)},onChange:function(e){t.set("opacity",e),o.renderAll(),n()},onComplete:function(){o.remove(t),r()}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e){if(t){var i="string"==typeof t?JSON.parse(t):t;!i||i&&!i.objects||(this.clear(),this.backgroundColor=i.background,this._enlivenDatalessObjects(i.objects,e))}},_enlivenDatalessObjects:function(t,e){function i(t,i){r.insertAt(t,i,!0),t.setCoords(),++n===o&&e&&e()}var r=this,n=0,o=t.length;0===o&&e&&e();try{t.forEach(function(t,e){var r=t.paths?"paths":"path",n=t[r];if(delete t[r],"string"!=typeof n)switch(t.type){case"image":fabric[fabric.util.string.capitalize(t.type)].fromObject(t,function(t){i(t,e)});break;default:var o=fabric[fabric.util.string.camelize(fabric.util.string.capitalize(t.type))];o&&o.fromObject&&(n&&(t[r]=n),i(o.fromObject(t),e))}else if("image"===t.type)fabric.util.loadImage(n,function(r){var o=new fabric.Image(r);o.setSourcePath(n),fabric.util.object.extend(o,t),o.setAngle(t.angle),i(o,e)});else if("text"===t.type)if(t.useNative)i(fabric.Text.fromObject(t),e);else{t.path=n;var s=fabric.Text.fromObject(t),a=function(){"[object Opera]"===Object.prototype.toString.call(fabric.window.opera)?setTimeout(function(){i(s,e)},500):i(s,e)};fabric.util.getScript(n,a)}else fabric.loadSVGFromURL(n,function(r,o){var s=fabric.util.groupSVGElements(r,t,n);s instanceof fabric.PathGroup||(fabric.util.object.extend(s,t),"undefined"!=typeof t.angle&&s.setAngle(t.angle)),i(s,e)})},this)}catch(s){fabric.log(s.message)}},loadFromJSON:function(t,e){if(t){var i=JSON.parse(t);if(i&&(!i||i.objects)){this.clear();var r=this;return this._enlivenObjects(i.objects,function(){r.backgroundColor=i.background,i.backgroundImage?r.setBackgroundImage(i.backgroundImage,function(){r.backgroundImageOpacity=i.backgroundImageOpacity,r.backgroundImageStretch=i.backgroundImageStretch,r.renderAll(),e&&e()}):e&&e()}),this}}},_enlivenObjects:function(t,e){var i=this;fabric.util.enlivenObjects(t,function(t){t.forEach(function(t,e){i.insertAt(t,e,!0)}),e&&e()})},_toDataURL:function(t,e){this.clone(function(i){e(i.toDataURL(t))})},_toDataURLWithMultiplier:function(t,e,i){this.clone(function(r){i(r.toDataURLWithMultiplier(t,e))})},clone:function(t){var e=JSON.stringify(this);this.cloneWithoutData(function(i){i.loadFromJSON(e,function(){t&&t(i)})})},cloneWithoutData:function(t){var e=fabric.document.createElement("canvas");e.width=this.getWidth(),e.height=this.getHeight();var i=new fabric.Canvas(e);i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,r=(e.util.object.clone,e.util.toFixed),n=e.util.string.capitalize,o=e.util.getPointer,s=e.util.degreesToRadians,a=Array.prototype.slice;if(!e.Object){e.Object=e.util.createClass({type:"object",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornersize:12,transparentCorners:!0,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",fillRule:"source-over",overlayFill:null,stroke:null,strokeWidth:1,strokeDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,selectable:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!1,rotatingPointOffset:40,_theta:0,perPixelTargetFind:!1,includeDefaultValues:!0,stateProperties:"top left width height scaleX scaleY flipX flipY theta angle opacity cornersize fill overlayFill stroke strokeWidth strokeDashArray fillRule borderScaleFactor transformMatrix selectable".split(" "),callSuper:function(t){var e=this.constructor.superclass.prototype[t];return arguments.length>1?e.apply(this,a.call(arguments,1)):e.call(this)},initialize:function(t){t&&(this.setOptions(t),this._initGradient(t))},_initGradient:function(t){!t.fill||"object"!=typeof t.fill||t.fill instanceof e.Gradient||this.set("fill",new e.Gradient(t.fill))},setOptions:function(t){for(var e,i=this.stateProperties.length;i--;)e=this.stateProperties[i],e in t&&this.set(e,t[e])},transform:function(t){t.globalAlpha=this.opacity,t.translate(this.left,this.top),t.rotate(this._theta),t.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(){var t=e.Object.NUM_FRACTION_DIGITS,i={type:this.type,left:r(this.left,t),top:r(this.top,t),width:r(this.width,t),height:r(this.height,t),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,overlayFill:this.overlayFill,stroke:this.stroke,strokeWidth:this.strokeWidth,strokeDashArray:this.strokeDashArray,scaleX:r(this.scaleX,t),scaleY:r(this.scaleY,t),angle:r(this.getAngle(),t),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,t),selectable:this.selectable,hasControls:this.hasControls,hasBorders:this.hasBorders,hasRotatingPoint:this.hasRotatingPoint,transparentCorners:this.transparentCorners,perPixelTargetFind:this.perPixelTargetFind};return this.includeDefaultValues||(i=this._removeDefaultValues(i)),i},toDatalessObject:function(){return this.toObject()},getSvgStyles:function(){return["stroke: ",this.stroke?this.stroke:"none","; ","stroke-width: ",this.strokeWidth?this.strokeWidth:"0","; ","stroke-dasharray: ",this.strokeDashArray?this.strokeDashArray.join(" "):"; ","fill: ",this.fill?this.fill:"none","; ","opacity: ",this.opacity?this.opacity:"1",";"].join("")},getSvgTransform:function(){var t=this.getAngle();return["translate(",r(this.left,2)," ",r(this.top,2),")",0!==t?" rotate("+r(t,2)+")":"",1===this.scaleX&&1===this.scaleY?"":" scale("+r(this.scaleX,2)+" "+r(this.scaleY,2)+")"].join("")},_removeDefaultValues:function(t){var i=e.Object.prototype.options;return i&&this.stateProperties.forEach(function(e){t[e]===i[e]&&delete t[e]}),t},isActive:function(){return!!this.active},setActive:function(t){return this.active=!!t,this},toString:function(){return"#<fabric."+n(this.type)+">"},set:function(t,e){if("object"==typeof t)for(var i in t)this._set(i,t[i]);else"function"==typeof e?this._set(t,e(this.get(t))):this._set(t,e);return this},_set:function(t,i){var r=("scaleX"===t||"scaleY"===t)&&i<e.Object.MIN_SCALE_LIMIT;r&&(i=e.Object.MIN_SCALE_LIMIT),"angle"===t?this.setAngle(i):this[t]=i},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},setSourcePath:function(t){return this.sourcePath=t,this},get:function(t){return"angle"===t?this.getAngle():this[t]},render:function(t,e){if(0!==this.width&&0!==this.height){t.save();var i=this.transformMatrix;i&&!this.group&&t.setTransform(i[0],i[1],i[2],i[3],i[4],i[5]),e||this.transform(t),(this.stroke||this.strokeDashArray)&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.stroke),this.overlayFill?t.fillStyle=this.overlayFill:this.fill&&(t.fillStyle=this.fill.toLiveGradient?this.fill.toLiveGradient(t):this.fill),i&&this.group&&(t.translate(-this.group.width/2,-this.group.height/2),t.transform(i[0],i[1],i[2],i[3],i[4],i[5])),this._render(t,e),this.active&&!e&&(this.drawBorders(t),this.drawCorners(t)),t.restore()}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},scale:function(t){return this.scaleX=t,this.scaleY=t,this.setCoords(),this},scaleToWidth:function(t){var e=this.getBoundingRectWidth()/this.getWidth();return this.scale(t/this.width/e)},scaleToHeight:function(t){var e=this.getBoundingRectHeight()/this.getHeight();return this.scale(t/this.height/e)},setOpacity:function(t){return this.set("opacity",t),this},getAngle:function(){return 180*this._theta/Math.PI},setAngle:function(t){return this._theta=t/180*Math.PI,this.angle=t,this},setCoords:function(){var t=this.strokeWidth>1?this.strokeWidth:0,e=this.padding;this.currentWidth=(this.width+t)*this.scaleX+2*e,this.currentHeight=(this.height+t)*this.scaleY+2*e,this._hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),this._angle=Math.atan(this.currentHeight/this.currentWidth);var i=Math.cos(this._angle+this._theta)*this._hypotenuse,r=Math.sin(this._angle+this._theta)*this._hypotenuse,n=this._theta,o=Math.sin(n),s=Math.cos(n),a={x:this.left-i,y:this.top-r},c={x:a.x+this.currentWidth*s,y:a.y+this.currentWidth*o},h={x:c.x-this.currentHeight*o,y:c.y+this.currentHeight*s},l={x:a.x-this.currentHeight*o,y:a.y+this.currentHeight*s},u={x:a.x-this.currentHeight/2*o,y:a.y+this.currentHeight/2*s},f={x:a.x+this.currentWidth/2*s,y:a.y+this.currentWidth/2*o},d={x:c.x-this.currentHeight/2*o,y:c.y+this.currentHeight/2*s},p={x:l.x+this.currentWidth/2*s,y:l.y+this.currentWidth/2*o},g={x:a.x+this.currentWidth/2*s,y:a.y+this.currentWidth/2*o};return this.oCoords={tl:a,tr:c,br:h,bl:l,ml:u,mt:f,mr:d,mb:p,mtr:g},this._setCornerCoords(),this},getBoundingRectWidth:function(){this.oCoords||this.setCoords();var t=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],i=e.util.array.min(t),r=e.util.array.max(t);return Math.abs(i-r)},getBoundingRectHeight:function(){this.oCoords||this.setCoords();var t=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],i=e.util.array.min(t),r=e.util.array.max(t);return Math.abs(i-r)},drawBorders:function(t){if(this.hasBorders){var i=e.Object.MIN_SCALE_LIMIT,r=this.padding,n=2*r,o=this.strokeWidth>1?this.strokeWidth:0;t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=this.borderColor;var s=1/(this.scaleX<i?i:this.scaleX),a=1/(this.scaleY<i?i:this.scaleY);t.lineWidth=1/this.borderScaleFactor,t.scale(s,a);var c=this.getWidth(),h=this.getHeight();if(t.strokeRect(~~(-(c/2)-r-o/2*this.scaleX)+.5,~~(-(h/2)-r-o/2*this.scaleY)+.5,~~(c+n+o*this.scaleX),~~(h+n+o*this.scaleY)),this.hasRotatingPoint&&!this.lockRotation&&this.hasControls){var l=(this.flipY?h+o*this.scaleY+2*r:-h-o*this.scaleY-2*r)/2;t.beginPath(),t.moveTo(0,l),t.lineTo(0,l+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),t.closePath(),t.stroke()}return t.restore(),this}},_renderDashedStroke:function(t){function e(e,c){for(var h=0,l=(c?o.height:o.width)+2*s;l>h;){var u=o.strokeDashArray[i++];if(h+=u,h>l)var f=h-l;e?r+=u*e-(f*e||0):n+=u*c-(f*c||0),t[1&i?"moveTo":"lineTo"](r,n),i>=a&&(i=0)}}1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray);var i=0,r=-this.width/2,n=-this.height/2,o=this,s=this.padding,a=(this.getWidth(),this.getHeight(),this.strokeDashArray.length);t.save(),t.beginPath(),e(1,0),e(0,1),e(-1,0),e(0,-1),t.stroke(),t.closePath(),t.restore()},drawCorners:function(t){if(this.hasControls){var e,i,r=this.cornersize,n=r/2,o=this.strokeWidth/2,s=-(this.width/2),a=-(this.height/2),c=r/this.scaleX,h=r/this.scaleY,l=this.padding/this.scaleX,u=this.padding/this.scaleY,f=n/this.scaleY,d=n/this.scaleX,p=(n-r)/this.scaleX,g=(n-r)/this.scaleY,v=this.height,b=this.width,m=this.transparentCorners?"strokeRect":"fillRect";return t.save(),t.lineWidth=1/Math.max(this.scaleX,this.scaleY),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=t.fillStyle=this.cornerColor,e=s-d-o-l,i=a-f-o-u,t.clearRect(e,i,c,h),t[m](e,i,c,h),e=s+b-d+o+l,i=a-f-o-u,t.clearRect(e,i,c,h),t[m](e,i,c,h),e=s-d-o-l,i=a+v+g+o+u,t.clearRect(e,i,c,h),t[m](e,i,c,h),e=s+b+p+o+l,i=a+v+g+o+u,t.clearRect(e,i,c,h),t[m](e,i,c,h),this.lockUniScaling||(e=s+b/2-d,i=a-f-o-u,t.clearRect(e,i,c,h),t[m](e,i,c,h),e=s+b/2-d,i=a+v+g+o+u,t.clearRect(e,i,c,h),t[m](e,i,c,h),e=s+b+p+o+l,i=a+v/2-f,t.clearRect(e,i,c,h),t[m](e,i,c,h),e=s-d-o-l,i=a+v/2-f,t.clearRect(e,i,c,h),t[m](e,i,c,h)),this.hasRotatingPoint&&(e=s+b/2-d,i=this.flipY?a+v+this.rotatingPointOffset/this.scaleY-h/2+o+u:a-this.rotatingPointOffset/this.scaleY-h/2-o-u,t.clearRect(e,i,c,h),t[m](e,i,c,h)),t.restore(),this}},clone:function(t){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(),t):new e.Object(this.toObject())},cloneAsImage:function(t){if(e.Image){var i=new Image;i.onload=function(){t&&t(new e.Image(i),r),i=i.onload=null};var r={angle:this.get("angle"),flipX:this.get("flipX"),flipY:this.get("flipY")};this.set("angle",0).set("flipX",!1).set("flipY",!1),this.toDataURL(function(t){i.src=t})}return this},toDataURL:function(t){function i(e){e.left=r.width/2,e.top=r.height/2,e.setActive(!1),n.add(e);var i=n.toDataURL("png");n.dispose(),n=e=null,t&&t(i)}var r=e.document.createElement("canvas");r.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(r),r.width=this.getBoundingRectWidth(),r.height=this.getBoundingRectHeight(),e.util.wrapElement(r,"div");var n=new e.Canvas(r);n.backgroundColor="transparent",n.renderAll(),this.constructor.async?this.clone(i):i(this.clone())},hasStateChanged:function(){return this.stateProperties.some(function(t){return this[t]!==this.originalState[t]},this)},saveState:function(){return this.stateProperties.forEach(function(t){this.originalState[t]=this.get(t)},this),this},setupState:function(){this.originalState={},this.saveState()},intersectsWithRect:function(t,i){var r=this.oCoords,n=new e.Point(r.tl.x,r.tl.y),o=new e.Point(r.tr.x,r.tr.y),s=new e.Point(r.bl.x,r.bl.y),a=new e.Point(r.br.x,r.br.y),c=e.Intersection.intersectPolygonRectangle([n,o,a,s],t,i);return"Intersection"===c.status},intersectsWithObject:function(t){function i(t){return{tl:new e.Point(t.tl.x,t.tl.y),tr:new e.Point(t.tr.x,t.tr.y),bl:new e.Point(t.bl.x,t.bl.y),br:new e.Point(t.br.x,t.br.y)}}var r=i(this.oCoords),n=i(t.oCoords),o=e.Intersection.intersectPolygonPolygon([r.tl,r.tr,r.br,r.bl],[n.tl,n.tr,n.br,n.bl]);return"Intersection"===o.status},isContainedWithinObject:function(t){return this.isContainedWithinRect(t.oCoords.tl,t.oCoords.br)},isContainedWithinRect:function(t,i){var r=this.oCoords,n=new e.Point(r.tl.x,r.tl.y),o=new e.Point(r.tr.x,r.tr.y),s=new e.Point(r.bl.x,r.bl.y);new e.Point(r.br.x,r.br.y);return n.x>t.x&&o.x<i.x&&n.y>t.y&&s.y<i.y},isType:function(t){return this.type===t},_findTargetCorner:function(t,e){if(!this.hasControls||!this.active)return!1;var i,r,n=o(t),s=n.x-e.left,a=n.y-e.top;for(var c in this.oCoords)if(("mtr"!==c||this.hasRotatingPoint)&&(!this.lockUniScaling||"mt"!==c&&"mr"!==c&&"mb"!==c&&"ml"!==c)&&(r=this._getImageLines(this.oCoords[c].corner,c),i=this._findCrossPoints(s,a,r),i%2==1&&0!=i))return this.__corner=c,c;return!1},_findCrossPoints:function(t,e,i){var r,n,o,s,a,c,h,l=0;for(var u in i)if(h=i[u],!(h.o.y<e&&h.d.y<e||h.o.y>=e&&h.d.y>=e||(h.o.x==h.d.x&&h.o.x>=t?(a=h.o.x,c=e):(r=0,n=(h.d.y-h.o.y)/(h.d.x-h.o.x),o=e-r*t,s=h.o.y-n*h.o.x,a=-(o-s)/(r-n),c=o+r*a),a>=t&&(l+=1),2!=l)))break;return l},_getImageLines:function(t,e){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_setCornerCoords:function(){var t=this.oCoords,e=s(45-this.getAngle()),i=Math.sqrt(2*Math.pow(this.cornersize,2))/2,r=i*Math.cos(e),n=i*Math.sin(e),o=Math.sin(this._theta),a=Math.cos(this._theta);t.tl.corner={tl:{x:t.tl.x-n,y:t.tl.y-r},tr:{x:t.tl.x+r,y:t.tl.y-n},bl:{x:t.tl.x-r,y:t.tl.y+n},br:{x:t.tl.x+n,y:t.tl.y+r}},t.tr.corner={tl:{x:t.tr.x-n,y:t.tr.y-r},tr:{x:t.tr.x+r,y:t.tr.y-n},br:{x:t.tr.x+n,y:t.tr.y+r},bl:{x:t.tr.x-r,y:t.tr.y+n}},t.bl.corner={tl:{x:t.bl.x-n,y:t.bl.y-r},bl:{x:t.bl.x-r,y:t.bl.y+n},br:{x:t.bl.x+n,y:t.bl.y+r},tr:{x:t.bl.x+r,y:t.bl.y-n}},t.br.corner={tr:{x:t.br.x+r,y:t.br.y-n},bl:{x:t.br.x-r,y:t.br.y+n},br:{x:t.br.x+n,y:t.br.y+r},tl:{x:t.br.x-n,y:t.br.y-r}},t.ml.corner={tl:{x:t.ml.x-n,y:t.ml.y-r},tr:{x:t.ml.x+r,y:t.ml.y-n},bl:{x:t.ml.x-r,y:t.ml.y+n},br:{x:t.ml.x+n,y:t.ml.y+r}},t.mt.corner={tl:{x:t.mt.x-n,y:t.mt.y-r},tr:{x:t.mt.x+r,y:t.mt.y-n},bl:{x:t.mt.x-r,y:t.mt.y+n},br:{x:t.mt.x+n,y:t.mt.y+r}},t.mr.corner={tl:{x:t.mr.x-n,y:t.mr.y-r},tr:{x:t.mr.x+r,y:t.mr.y-n},bl:{x:t.mr.x-r,y:t.mr.y+n},br:{x:t.mr.x+n,y:t.mr.y+r}},t.mb.corner={tl:{x:t.mb.x-n,y:t.mb.y-r},tr:{x:t.mb.x+r,y:t.mb.y-n},bl:{x:t.mb.x-r,y:t.mb.y+n},br:{x:t.mb.x+n,y:t.mb.y+r}},t.mtr.corner={tl:{x:t.mtr.x-n+o*this.rotatingPointOffset,y:t.mtr.y-r-a*this.rotatingPointOffset},tr:{x:t.mtr.x+r+o*this.rotatingPointOffset,y:t.mtr.y-n-a*this.rotatingPointOffset},bl:{x:t.mtr.x-r+o*this.rotatingPointOffset,y:t.mtr.y+n-a*this.rotatingPointOffset},br:{x:t.mtr.x+n+o*this.rotatingPointOffset,y:t.mtr.y+r-a*this.rotatingPointOffset}}},toGrayscale:function(){var t=this.get("fill");return t&&this.set("overlayFill",new e.Color(t).toGrayscale().toRgb()),this},complexity:function(){return 0},toJSON:function(){return this.toObject()},setGradientFill:function(t){this.set("fill",e.Gradient.forObject(this,t))},animate:function(){if(arguments[0]&&"object"==typeof arguments[0])for(var t in arguments[0])this._animate(t,arguments[0][t],arguments[1]);else this._animate.apply(this,arguments);return this},_animate:function(t,i,r){var n=this;r||(r={}),"from"in r||(r.from=this.get(t)),/[+-]/.test((i+"").charAt(0))&&(i=this.get(t)+parseFloat(i)),e.util.animate({startValue:r.from,endValue:i,byValue:r.by,easing:r.easing,duration:r.duration,onChange:function(e){n.set(t,e),r.onChange&&r.onChange()},onComplete:function(){n.setCoords(),r.onComplete&&r.onComplete()}})},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.centerH().centerV()},remove:function(){return this.canvas.remove(this)},sendToBack:function(){return this.canvas.sendToBack(this),this},bringToFront:function(){return this.canvas.bringToFront(this),this},sendBackwards:function(){return this.canvas.sendBackwards(this),this},bringForward:function(){return this.canvas.bringForward(this),this}}),e.Object.prototype.rotate=e.Object.prototype.setAngle;for(var c=e.Object.prototype,h=c.stateProperties.length;h--;){var l=c.stateProperties[h],u=l.charAt(0).toUpperCase()+l.slice(1),f="set"+u,d="get"+u;c[d]||(c[d]=function(t){return new Function('return this.get("'+t+'")')}(l)),c[f]||(c[f]=function(t){return new Function("value",'return this.set("'+t+'", value)');
}(l))}i(e.Object.prototype,e.Observable),i(e.Object,{NUM_FRACTION_DIGITS:2,MIN_SCALE_LIMIT:.1})}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,r=(e.Object.prototype.set,{x1:1,x2:1,y1:1,y2:1});return e.Line?void e.warn("fabric.Line is already defined"):(e.Line=e.util.createClass(e.Object,{type:"line",initialize:function(t,e){t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.set("width",this.x2-this.x1||1),this.set("height",this.y2-this.y1||1),this.set("left","left"in t?t.left:this.x1+this.width/2),this.set("top","top"in t?t.top:this.y1+this.height/2)},_set:function(t,e){return this[t]=e,t in r&&this._setWidthHeight(),this},_render:function(t){t.beginPath(),this.group&&t.translate(-this.group.width/2+this.left,-this.group.height/2+this.top),t.moveTo(1===this.width?0:-this.width/2,1===this.height?0:-this.height/2),t.lineTo(1===this.width?0:this.width/2,1===this.height?0:this.height/2),t.lineWidth=this.strokeWidth;var e=t.strokeStyle;t.strokeStyle=t.fillStyle,t.stroke(),t.strokeStyle=e},complexity:function(){return 1},toObject:function(){return i(this.callSuper("toObject"),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(){return["<line ",'x1="',this.get("x1"),'" ','y1="',this.get("y1"),'" ','x2="',this.get("x2"),'" ','y2="',this.get("y2"),'" ','style="',this.getSvgStyles(),'" ',"/>"].join("")}}),e.Line.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" "),e.Line.fromElement=function(t,r){var n=e.parseAttributes(t,e.Line.ATTRIBUTE_NAMES),o=[n.x1||0,n.y1||0,n.x2||0,n.y2||0];return new e.Line(o,i(n,r))},void(e.Line.fromObject=function(t){var i=[t.x1,t.y1,t.x2,t.y2];return new e.Line(i,t)}))}("undefined"!=typeof exports?exports:this),function(t){"use strict";function e(t){return"radius"in t&&t.radius>0}var i=t.fabric||(t.fabric={}),r=2*Math.PI,n=i.util.object.extend;return i.Circle?void i.warn("fabric.Circle is already defined."):(i.Circle=i.util.createClass(i.Object,{type:"circle",initialize:function(t){t=t||{},this.set("radius",t.radius||0),this.callSuper("initialize",t);var e=2*this.get("radius");this.set("width",e).set("height",e)},toObject:function(){return n(this.callSuper("toObject"),{radius:this.get("radius")})},toSVG:function(){return'<circle cx="0" cy="0" r="'+this.radius+'" style="'+this.getSvgStyles()+'" transform="'+this.getSvgTransform()+'" />'},_render:function(t,e){t.beginPath(),t.globalAlpha*=this.opacity,t.arc(e?this.left:0,e?this.top:0,this.radius,0,r,!1),t.closePath(),this.fill&&t.fill(),this.stroke&&t.stroke()},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){this.radius=t,this.set("width",2*t).set("height",2*t)},complexity:function(){return 1}}),i.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity opacity stroke stroke-width transform".split(" "),i.Circle.fromElement=function(t,r){r||(r={});var o=i.parseAttributes(t,i.Circle.ATTRIBUTE_NAMES);if(!e(o))throw Error("value of `r` attribute is required and can not be negative");return"left"in o&&(o.left-=r.width/2||0),"top"in o&&(o.top-=r.height/2||0),new i.Circle(n(o,r))},void(i.Circle.fromObject=function(t){return new i.Circle(t)}))}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});return e.Triangle?void e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("width",t.width||100).set("height",t.height||100)},_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this.fill&&t.fill(),this.stroke&&t.stroke()},complexity:function(){return 1},toSVG:function(){var t=this.width/2,e=this.height/2,i=[-t+" "+e,"0 "+-e,t+" "+e].join(",");return'<polygon points="'+i+'" style="'+this.getSvgStyles()+'" transform="'+this.getSvgTransform()+'" />'}}),void(e.Triangle.fromObject=function(t){return new e.Triangle(t)}))}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=2*Math.PI,r=e.util.object.extend;return e.Ellipse?void e.warn("fabric.Ellipse is already defined."):(e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("rx",t.rx||0),this.set("ry",t.ry||0),this.set("width",2*this.get("rx")),this.set("height",2*this.get("ry"))},toObject:function(){return r(this.callSuper("toObject"),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(){return["<ellipse ",'rx="',this.get("rx"),'" ','ry="',this.get("ry"),'" ','style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',"/>"].join("")},render:function(t,e){return 0!==this.rx&&0!==this.ry?this.callSuper("render",t,e):void 0},_render:function(t,e){t.beginPath(),t.save(),t.globalAlpha*=this.opacity,this.transformMatrix&&this.group&&t.translate(this.cx,this.cy),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(e?this.left:0,e?this.top:0,this.rx,0,i,!1),this.stroke&&t.stroke(),this.fill&&t.fill(),t.restore()},complexity:function(){return 1}}),e.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity opacity stroke stroke-width transform".split(" "),e.Ellipse.fromElement=function(t,i){i||(i={});var n=e.parseAttributes(t,e.Ellipse.ATTRIBUTE_NAMES),o=n.left,s=n.top;"left"in n&&(n.left-=i.width/2||0),"top"in n&&(n.top-=i.height/2||0);var a=new e.Ellipse(r(n,i));return a.cx=o||0,a.cy=s||0,a},void(e.Ellipse.fromObject=function(t){return new e.Ellipse(t)}))}("undefined"!=typeof exports?exports:this),function(t){"use strict";function e(t){return t.left=t.left||0,t.top=t.top||0,t}var i=t.fabric||(t.fabric={});return i.Rect?void console.warn("fabric.Rect is already defined"):(i.Rect=i.util.createClass(i.Object,{type:"rect",rx:0,ry:0,initialize:function(t){this._initStateProperties(),this.callSuper("initialize",t),this._initRxRy()},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat(["rx","ry"])},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t){var e=this.rx||0,i=this.ry||0,r=-this.width/2,n=-this.height/2,o=this.width,s=this.height;t.beginPath(),t.globalAlpha*=this.opacity,this.transformMatrix&&this.group&&t.translate(this.width/2+this.x,this.height/2+this.y),!this.transformMatrix&&this.group&&t.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y),t.moveTo(r+e,n),t.lineTo(r+o-e,n),t.quadraticCurveTo(r+o,n,r+o,n+i,r+o,n+i),t.lineTo(r+o,n+s-i),t.quadraticCurveTo(r+o,n+s,r+o-e,n+s,r+o-e,n+s),t.lineTo(r+e,n+s),t.quadraticCurveTo(r,n+s,r,n+s-i,r,n+s-i),t.lineTo(r,n+i),t.quadraticCurveTo(r,n,r+e,n,r+e,n),t.closePath(),this.fill&&t.fill(),this.strokeDashArray?this._renderDashedStroke(t):this.stroke&&t.stroke()},_normalizeLeftTopProperties:function(t){return t.left&&this.set("left",t.left+this.getWidth()/2),this.set("x",t.left||0),t.top&&this.set("top",t.top+this.getHeight()/2),this.set("y",t.top||0),this},complexity:function(){return 1},toObject:function(){return i.util.object.extend(this.callSuper("toObject"),{rx:this.get("rx")||0,ry:this.get("ry")||0})},toSVG:function(){return'<rect x="'+-1*this.width/2+'" y="'+-1*this.height/2+'" rx="'+this.get("rx")+'" ry="'+this.get("ry")+'" width="'+this.width+'" height="'+this.height+'" style="'+this.getSvgStyles()+'" transform="'+this.getSvgTransform()+'" />'}}),i.Rect.ATTRIBUTE_NAMES="x y width height rx ry fill fill-opacity opacity stroke stroke-width transform".split(" "),i.Rect.fromElement=function(t,r){if(!t)return null;var n=i.parseAttributes(t,i.Rect.ATTRIBUTE_NAMES);n=e(n);var o=new i.Rect(i.util.object.extend(r?i.util.object.clone(r):{},n));return o._normalizeLeftTopProperties(n),o},void(i.Rect.fromObject=function(t){return new i.Rect(t)}))}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.toFixed;return e.Polyline?void e.warn("fabric.Polyline is already defined"):(e.Polyline=e.util.createClass(e.Object,{type:"polyline",initialize:function(t,e){e=e||{},this.set("points",t),this.callSuper("initialize",e),this._calcDimensions()},_calcDimensions:function(){return e.Polygon.prototype._calcDimensions.call(this)},toObject:function(){return e.Polygon.prototype.toObject.call(this)},toSVG:function(){for(var t=[],e=0,r=this.points.length;r>e;e++)t.push(i(this.points[e].x,2),",",i(this.points[e].y,2)," ");return["<polyline ",'points="',t.join(""),'" ','style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',"/>"].join("")},_render:function(t){var e;t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var i=0,r=this.points.length;r>i;i++)e=this.points[i],t.lineTo(e.x,e.y);this.fill&&t.fill(),this.stroke&&t.stroke()},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES="fill fill-opacity opacity stroke stroke-width transform".split(" "),e.Polyline.fromElement=function(t,i){if(!t)return null;i||(i={});for(var r=e.parsePointsAttribute(t.getAttribute("points")),n=e.parseAttributes(t,e.Polyline.ATTRIBUTE_NAMES),o=0,s=r.length;s>o;o++)r[o].x-=i.width/2||0,r[o].y-=i.height/2||0;return new e.Polyline(r,e.util.object.extend(n,i))},void(e.Polyline.fromObject=function(t){var i=t.points;return new e.Polyline(i,t)}))}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,r=e.util.array.min,n=e.util.array.max,o=e.util.toFixed;return e.Polygon?void e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Object,{type:"polygon",initialize:function(t,e){e=e||{},this.points=t,this.callSuper("initialize",e),this._calcDimensions()},_calcDimensions:function(){var t=this.points,e=r(t,"x"),i=r(t,"y"),o=n(t,"x"),s=n(t,"y");this.width=o-e||1,this.height=s-i||1,this.minX=e,this.minY=i},toObject:function(){return i(this.callSuper("toObject"),{points:this.points.concat()})},toSVG:function(){for(var t=[],e=0,i=this.points.length;i>e;e++)t.push(o(this.points[e].x,2),",",o(this.points[e].y,2)," ");return["<polygon ",'points="',t.join(""),'" ','style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',"/>"].join("")},_render:function(t){var e;t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var i=0,r=this.points.length;r>i;i++)e=this.points[i],t.lineTo(e.x,e.y);this.fill&&t.fill(),this.stroke&&(t.closePath(),t.stroke())},complexity:function(){return this.points.length}}),e.Polygon.ATTRIBUTE_NAMES="fill fill-opacity opacity stroke stroke-width transform".split(" "),e.Polygon.fromElement=function(t,r){if(!t)return null;r||(r={});for(var n=e.parsePointsAttribute(t.getAttribute("points")),o=e.parseAttributes(t,e.Polygon.ATTRIBUTE_NAMES),s=0,a=n.length;a>s;s++)n[s].x-=r.width/2||0,n[s].y-=r.height/2||0;return new e.Polygon(n,i(o,r))},void(e.Polygon.fromObject=function(t){return new e.Polygon(t.points,t)}))}("undefined"!=typeof exports?exports:this),function(t){function e(t,e,n,o){for(var s=o[0],a=o[1],c=o[2],h=o[3],l=o[4],u=o[5],f=o[6],d=i(u,f,s,a,h,l,c,e,n),p=0;p<d.length;p++){var g=r.apply(this,d[p]);t.bezierCurveTo.apply(t,g)}}function i(t,e,i,r,n,o,a,h,u){if(s=l.call(arguments),c[s])return c[s];var f=a*(Math.PI/180),d=Math.sin(f),p=Math.cos(f);i=Math.abs(i),r=Math.abs(r);var g=p*(h-t)*.5+d*(u-e)*.5,v=p*(u-e)*.5-d*(h-t)*.5,b=g*g/(i*i)+v*v/(r*r);b>1&&(b=Math.sqrt(b),i*=b,r*=b);var m=p/i,y=d/i,x=-d/r,C=p/r,w=m*h+y*u,S=x*h+C*u,_=m*t+y*e,O=x*t+C*e,j=(_-w)*(_-w)+(O-S)*(O-S),T=1/j-.25;0>T&&(T=0);var A=Math.sqrt(T);o==n&&(A=-A);var k=.5*(w+_)-A*(O-S),I=.5*(S+O)+A*(_-w),E=Math.atan2(S-I,w-k),P=Math.atan2(O-I,_-k),M=P-E;0>M&&1==o?M+=2*Math.PI:M>0&&0==o&&(M-=2*Math.PI);for(var D=Math.ceil(Math.abs(M/(.5*Math.PI+.001))),F=[],R=0;D>R;R++){var L=E+R*M/D,N=E+(R+1)*M/D;F[R]=[k,I,L,N,i,r,d,p]}return c[s]=F}function r(t,e,i,r,n,o,a,c){if(s=l.call(arguments),h[s])return h[s];var u=c*n,f=-a*o,d=a*n,p=c*o,g=.5*(r-i),v=8/3*Math.sin(.5*g)*Math.sin(.5*g)/Math.sin(g),b=t+Math.cos(i)-v*Math.sin(i),m=e+Math.sin(i)+v*Math.cos(i),y=t+Math.cos(r),x=e+Math.sin(r),C=y+v*Math.sin(r),w=x-v*Math.cos(r);return h[s]=[u*b+f*m,d*b+p*m,u*C+f*w,d*C+p*w,u*y+f*x,d*y+p*x]}function n(t){return"H"===t[0]?t[1]:t[t.length-2]}function o(t){return"V"===t[0]?t[1]:t[t.length-1]}var s,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},c={},h={},l=Array.prototype.join,u=t.fabric||(t.fabric={}),f=u.util.array.min,d=u.util.array.max,p=u.util.object.extend,g=Object.prototype.toString;return u.Path?void u.warn("fabric.Path is already defined"):u.Object?(u.Path=u.util.createClass(u.Object,{type:"path",initialize:function(t,e){if(e=e||{},this.setOptions(e),!t)throw Error("`path` argument is required");var i="[object Array]"===g.call(t);this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(i||this._initializeFromString(e),e.sourcePath&&this.setSourcePath(e.sourcePath))},_initializeFromString:function(t){var e="width"in t,i="height"in t;this.path=this._parsePath(),e&&i||(p(this,this._parseDimensions()),e&&(this.width=t.width),i&&(this.height=t.height))},_render:function(t){for(var i,r,n,o,s,a=null,c=0,h=0,l=0,u=0,f=-(this.width/2),d=-(this.height/2),p=0,g=this.path.length;g>p;++p){switch(i=this.path[p],i[0]){case"l":c+=i[1],h+=i[2],t.lineTo(c+f,h+d);break;case"L":c=i[1],h=i[2],t.lineTo(c+f,h+d);break;case"h":c+=i[1],t.lineTo(c+f,h+d);break;case"H":c=i[1],t.lineTo(c+f,h+d);break;case"v":h+=i[1],t.lineTo(c+f,h+d);break;case"V":h=i[1],t.lineTo(c+f,h+d);break;case"m":c+=i[1],h+=i[2],t.moveTo(c+f,h+d);break;case"M":c=i[1],h=i[2],t.moveTo(c+f,h+d);break;case"c":r=c+i[5],n=h+i[6],l=c+i[3],u=h+i[4],t.bezierCurveTo(c+i[1]+f,h+i[2]+d,l+f,u+d,r+f,n+d),c=r,h=n;break;case"C":c=i[5],h=i[6],l=i[3],u=i[4],t.bezierCurveTo(i[1]+f,i[2]+d,l+f,u+d,c+f,h+d);break;case"s":r=c+i[3],n=h+i[4],l=2*c-l,u=2*h-u,t.bezierCurveTo(l+f,u+d,c+i[1]+f,h+i[2]+d,r+f,n+d),l=c+i[1],u=h+i[2],c=r,h=n;break;case"S":r=i[3],n=i[4],l=2*c-l,u=2*h-u,t.bezierCurveTo(l+f,u+d,i[1]+f,i[2]+d,r+f,n+d),c=r,h=n,l=i[1],u=i[2];break;case"q":r=c+i[3],n=h+i[4],l=c+i[1],u=h+i[2],t.quadraticCurveTo(l+f,u+d,r+f,n+d),c=r,h=n;break;case"Q":r=i[3],n=i[4],t.quadraticCurveTo(i[1]+f,i[2]+d,r+f,n+d),c=r,h=n,l=i[1],u=i[2];break;case"t":r=c+i[1],n=h+i[2],null===a[0].match(/[QqTt]/)?(l=c,u=h):"t"===a[0]?(l=2*c-o,u=2*h-s):"q"===a[0]&&(l=2*c-l,u=2*h-u),o=l,s=u,t.quadraticCurveTo(l+f,u+d,r+f,n+d),c=r,h=n,l=c+i[1],u=h+i[2];break;case"T":r=i[1],n=i[2],l=2*c-l,u=2*h-u,t.quadraticCurveTo(l+f,u+d,r+f,n+d),c=r,h=n;break;case"a":e(t,c+f,h+d,[i[1],i[2],i[3],i[4],i[5],i[6]+c+f,i[7]+h+d]),c+=i[6],h+=i[7];break;case"A":e(t,c+f,h+d,[i[1],i[2],i[3],i[4],i[5],i[6]+f,i[7]+d]),c=i[6],h=i[7];break;case"z":case"Z":t.closePath()}a=i}},render:function(t,e){t.save();var i=this.transformMatrix;i&&t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),e||this.transform(t),this.overlayFill?t.fillStyle=this.overlayFill:this.fill&&(t.fillStyle=this.fill.toLiveGradient?this.fill.toLiveGradient(t):this.fill),this.stroke&&(t.strokeStyle=this.stroke),t.beginPath(),this._render(t),this.fill&&t.fill(),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.lineCap=t.lineJoin="round",t.stroke()),!e&&this.active&&(this.drawBorders(t),this.hideCorners||this.drawCorners(t)),t.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(){var t=p(this.callSuper("toObject"),{path:this.path});return this.sourcePath&&(t.sourcePath=this.sourcePath),this.transformMatrix&&(t.transformMatrix=this.transformMatrix),t},toDatalessObject:function(){var t=this.toObject();return this.sourcePath&&(t.path=this.sourcePath),delete t.sourcePath,t},toSVG:function(){for(var t=[],e=0,i=this.path.length;i>e;e++)t.push(this.path[e].join(" "));var r=t.join(" ");return['<g transform="',this.getSvgTransform(),'">',"<path ",'width="',this.width,'" height="',this.height,'" ','d="',r,'" ','style="',this.getSvgStyles(),'" ','transform="translate(',-this.width/2," ",-this.height/2,')" />',"</g>"].join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var t,e,i,r,n,o=[],s=0,c=this.path.length;c>s;s++){t=this.path[s],e=t.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/),n=[t.charAt(0)];for(var r=0,h=e.length;h>r;r++)i=parseFloat(e[r]),isNaN(i)||n.push(i);var l=n[0].toLowerCase(),u=a[l];if(n.length-1>u)for(var f=1,d=n.length;d>f;f+=u)o.push([n[0]].concat(n.slice(f,f+u)));else o.push(n)}return o},_parseDimensions:function(){var t,e,i,r,s=[],a=[],c=!1;this.path.forEach(function(h,l){"H"!==h[0]&&(t=n(0===l?h:this.path[l-1])),"V"!==h[0]&&(e=o(0===l?h:this.path[l-1])),h[0]===h[0].toLowerCase()&&(c=!0),i=c?t+n(h):"V"===h[0]?t:n(h),r=c?e+o(h):"H"===h[0]?e:o(h);var u=parseInt(i,10);isNaN(u)||s.push(u),u=parseInt(r,10),isNaN(u)||a.push(u)},this);var h=f(s),l=f(a),u=0,p=0,g={top:l-p,left:h-u,bottom:d(a)-p,right:d(s)-u};return g.width=g.right-g.left,g.height=g.bottom-g.top,g}}),u.Path.fromObject=function(t){return new u.Path(t.path,t)},u.Path.ATTRIBUTE_NAMES="d fill fill-opacity opacity fill-rule stroke stroke-width transform".split(" "),void(u.Path.fromElement=function(t,e){var i=u.parseAttributes(t,u.Path.ATTRIBUTE_NAMES);return new u.Path(i.d,p(i,e))})):void u.warn("fabric.Path requires fabric.Object")}("undefined"!=typeof exports?exports:this),function(t){"use strict";function e(t){for(var e=0,r=t.length;r>e;e++)if(!(t[e]instanceof i.Object)){var n=s(a(t[e].type));t[e]=i[n].fromObject(t[e])}return t}var i=t.fabric||(t.fabric={}),r=i.util.object.extend,n=i.util.array.invoke,o=(i.Object.prototype.set,i.Object.prototype.toObject),s=i.util.string.camelize,a=i.util.string.capitalize;return i.PathGroup?void i.warn("fabric.PathGroup is already defined"):(i.PathGroup=i.util.createClass(i.Path,{type:"path-group",fill:"",forceFillOverwrite:!1,initialize:function(t,e){e=e||{},this.paths=t||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;this.setOptions(e),this.setCoords(),e.sourcePath&&this.setSourcePath(e.sourcePath)},render:function(t){t.save();var e=this.transformMatrix;e&&t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),this.transform(t);for(var i=0,r=this.paths.length;r>i;++i)this.paths[i].render(t,!0);this.active&&(this.drawBorders(t),this.hideCorners||this.drawCorners(t)),t.restore()},_set:function(t,e){if(("fill"===t||"overlayFill"===t)&&e&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(t,e);return this.callSuper("_set",t,e)},toObject:function(){return r(o.call(this),{paths:n(this.getObjects(),"clone"),sourcePath:this.sourcePath})},toDatalessObject:function(){var t=this.toObject();return this.sourcePath&&(t.paths=this.sourcePath),t},toSVG:function(){for(var t=this.getObjects(),e=["<g ",'width="',this.width,'" ','height="',this.height,'" ','style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"],i=0,r=t.length;r>i;i++)e.push(t[i].toSVG());return e.push("</g>"),e.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var t=this.getObjects()[0].get("fill");return this.getObjects().every(function(e){return e.get("fill")===t})},complexity:function(){return this.paths.reduce(function(t,e){return t+(e&&e.complexity?e.complexity():0)},0)},toGrayscale:function(){for(var t=this.paths.length;t--;)this.paths[t].toGrayscale();return this},getObjects:function(){return this.paths}}),void(i.PathGroup.fromObject=function(t){var r=e(t.paths);return new i.PathGroup(r,t)}))}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,r=e.util.array.min,n=e.util.array.max,o=e.util.array.invoke,s=e.util.removeFromArray;e.Group||(e.Group=e.util.createClass(e.Object,{type:"group",initialize:function(t,e){this.objects=t||[],this.originalState={},this.callSuper("initialize"),this._calcBounds(),this._updateObjectsCoords(),e&&i(this,e),this._setOpacityIfSame(),this.setCoords(!0),this.saveCoords()},_updateObjectsCoords:function(){var t=this.left,e=this.top;this.forEachObject(function(i){var r=i.get("left"),n=i.get("top");i.set("originalLeft",r),i.set("originalTop",n),i.set("left",r-t),i.set("top",n-e),i.setCoords(),i.hideCorners=!0},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this.objects},addWithUpdate:function(t){return this._restoreObjectsState(),this.objects.push(t),this._calcBounds(),this._updateObjectsCoords(),this},removeWithUpdate:function(t){return this._restoreObjectsState(),s(this.objects,t),t.setActive(!1),this._calcBounds(),this._updateObjectsCoords(),this},add:function(t){return this.objects.push(t),this},remove:function(t){return s(this.objects,t),this},size:function(){return this.getObjects().length},_set:function(t,e){if("fill"===t||"opacity"===t){var i=this.objects.length;for(this[t]=e;i--;)this.objects[i].set(t,e)}else this[t]=e},contains:function(t){return this.objects.indexOf(t)>-1},toObject:function(){return i(this.callSuper("toObject"),{objects:o(this.objects,"toObject")})},render:function(t,e){t.save(),this.transform(t);var i,r=Math.max(this.scaleX,this.scaleY),n=0;for(this.objects.length;i=this.objects[n];n++){var o=i.borderScaleFactor;i.borderScaleFactor=r,i.render(t),i.borderScaleFactor=o}!e&&this.active&&(this.drawBorders(t),this.hideCorners||this.drawCorners(t)),t.restore(),this.setCoords()},item:function(t){return this.getObjects()[t]},complexity:function(){return this.getObjects().reduce(function(t,e){return t+="function"==typeof e.complexity?e.complexity():0},0)},_restoreObjectsState:function(){return this.objects.forEach(this._restoreObjectState,this),this},_restoreObjectState:function(t){var e=this.get("left"),i=this.get("top"),r=this.getAngle()*(Math.PI/180),n=(t.get("originalLeft"),t.get("originalTop"),Math.cos(r)*t.get("top")+Math.sin(r)*t.get("left")),o=-Math.sin(r)*t.get("top")+Math.cos(r)*t.get("left");return t.setAngle(t.getAngle()+this.getAngle()),t.set("left",e+o*this.get("scaleX")),t.set("top",i+n*this.get("scaleY")),t.set("scaleX",t.get("scaleX")*this.get("scaleX")),t.set("scaleY",t.get("scaleY")*this.get("scaleY")),t.setCoords(),t.hideCorners=!1,t.setActive(!1),t.setCoords(),this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords()}),this},activateAllObjects:function(){return this.forEachObject(function(t){t.setActive()}),this},forEachObject:e.StaticCanvas.prototype.forEachObject,_setOpacityIfSame:function(){var t=this.getObjects(),e=t[0]?t[0].get("opacity"):1,i=t.every(function(t){return t.get("opacity")===e});i&&(this.opacity=e)},_calcBounds:function(){for(var t,e,i,o,s,a,c,h=[],l=[],u=0,f=this.objects.length;f>u;++u){s=this.objects[u],s.setCoords();for(var d in s.oCoords)h.push(s.oCoords[d].x),l.push(s.oCoords[d].y)}t=r(h),i=n(h),e=r(l),o=n(l),a=i-t||0,c=o-e||0,this.width=a,this.height=c,this.left=t+a/2||0,this.top=e+c/2||0},containsPoint:function(t){var e=this.get("width")/2,i=this.get("height")/2,r=this.get("left"),n=this.get("top");return r-e<t.x&&r+e>t.x&&n-i<t.y&&n+i>t.y},toGrayscale:function(){for(var t=this.objects.length;t--;)this.objects[t].toGrayscale()},toSVG:function(){for(var t=[],e=0,i=this.objects.length;i>e;e++)t.push(this.objects[e].toSVG());return'<g transform="'+this.getSvgTransform()+'">'+t.join("")+"</g>"}}),e.Group.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(r){delete t.objects,i&&i(new e.Group(r,t))})},e.Group.async=!0)}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=fabric.util.object.extend;return t.fabric||(t.fabric={}),t.fabric.Image?void fabric.warn("fabric.Image is already defined."):fabric.Object?(fabric.Image=fabric.util.createClass(fabric.Object,{active:!1,bordervisibility:!1,cornervisibility:!1,type:"image",initialize:function(t,e){e||(e={}),this.callSuper("initialize",e),this._initElement(t),this._originalImage=this.getElement(),this._initConfig(e),this.filters=[],e.filters&&(this.filters=e.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(t){return this._element=t,this._initConfig(),this},getOriginalSize:function(){var t=this.getElement();return{width:t.width,height:t.height}},setBorderVisibility:function(t){this._resetWidthHeight(),this._adjustWidthHeightToBorders(showBorder),this.setCoords()},setCornersVisibility:function(t){this.cornervisibility=!!t},render:function(t,e){t.save();var i=this.transformMatrix;this._resetWidthHeight(),this.group&&t.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2),i&&t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),e||this.transform(t),this._render(t),this.active&&!e&&(this.drawBorders(t),this.hideCorners||this.drawCorners(t)),t.restore()},toObject:function(){return e(this.callSuper("toObject"),{src:this._originalImage.src||this._originalImage._src,filters:this.filters.concat()})},toSVG:function(){return'<g transform="'+this.getSvgTransform()+'"><image xlink:href="'+this.getSvgSrc()+'" style="'+this.getSvgStyles()+'" transform="translate('+-this.width/2+" "+-this.height/2+')" width="'+this.width+'" height="'+this.height+'"/></g>'},getSrc:function(){return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(t){this.constructor.fromObject(this.toObject(),t)},applyFilters:function(t){if(0===this.filters.length)return this.setElement(this._originalImage),void(t&&t());var e="undefined"!=typeof Buffer&&"undefined"==typeof window,i=this._originalImage,r=fabric.document.createElement("canvas"),n=e?new(require("canvas").Image):fabric.document.createElement("img"),o=this;if(r.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(r),r.width=i.width,r.height=i.height,r.getContext("2d").drawImage(i,0,0,i.width,i.height),this.filters.forEach(function(t){t&&t.applyTo(r)}),n.onload=function(){o._element=n,t&&t(),n.onload=r=i=null},n.width=i.width,n.height=i.height,e){var s=r.toDataURL("image/png").replace(/data:image\/png;base64,/,"");n.src=new Buffer(s,"base64"),o._element=n,t&&t()}else n.src=r.toDataURL("image/png");return this},_render:function(t){t.drawImage(this.getElement(),-this.width/2,-this.height/2,this.width,this.height)},_adjustWidthHeightToBorders:function(t){t?(this.currentBorder=this.borderwidth,this.width+=2*this.currentBorder,this.height+=2*this.currentBorder):this.currentBorder=0},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width),this.set("height",t.height)},_initElement:function(t){this.setElement(fabric.util.getById(t)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setBorder(),this._setWidthHeight(t)},_initFilters:function(t){t.filters&&t.filters.length&&(this.filters=t.filters.map(function(t){return t&&fabric.Image.filters[t.type].fromObject(t)}))},_setBorder:function(){this.bordervisibility?this.currentBorder=this.borderwidth:this.currentBorder=0},_setWidthHeight:function(t){var e=2*this.currentBorder;this.width="width"in t?t.width:(this.getElement().width||0)+e,this.height="height"in t?t.height:(this.getElement().height||0)+e},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(t,e){var i=fabric.document.createElement("img"),r=t.src;t.width&&(i.width=t.width),t.height&&(i.height=t.height),i.onload=function(){fabric.Image.prototype._initFilters.call(t,t);var r=new fabric.Image(i,t);e&&e(r),i=i.onload=null},i.src=r},fabric.Image.fromURL=function(t,e,i){var r=fabric.document.createElement("img");r.onload=function(){e&&e(new fabric.Image(r,i)),r=r.onload=null},r.src=t},fabric.Image.ATTRIBUTE_NAMES="x y width height fill fill-opacity opacity stroke stroke-width transform xlink:href".split(" "),fabric.Image.fromElement=function(t,i,r){r||(r={});var n=fabric.parseAttributes(t,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(n["xlink:href"],i,e(n,r))},void(fabric.Image.async=!0)):void fabric.warn("fabric.Object is required for fabric.Image initialization")}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.get("angle");return t>-225&&-135>=t?-180:t>-135&&-45>=t?-90:t>-45&&45>=t?0:t>45&&135>=t?90:t>135&&225>=t?180:t>225&&315>=t?270:t>315?360:0},straighten:function(){var t=this._getAngleValueForStraighten();return this.setAngle(t),this},fxStraighten:function(t){t=t||{};var e=function(){},i=t.onComplete||e,r=t.onChange||e,n=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){n.setAngle(t),r()},onComplete:function(){n.setCoords(),i()},onStart:function(){n.setActive(!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.renderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters={},fabric.Image.filters.Grayscale=fabric.util.createClass({type:"Grayscale",applyTo:function(t){var e,i,r,n,o=t.getContext("2d"),s=o.getImageData(0,0,t.width,t.height),a=s.data,c=s.width,h=s.height;for(r=0;c>r;r++)for(n=0;h>n;n++)e=4*r*h+4*n,i=(a[e]+a[e+1]+a[e+2])/3,a[e]=i,a[e+1]=i,a[e+2]=i;o.putImageData(s,0,0)},toJSON:function(){return{type:this.type}}}),fabric.Image.filters.Grayscale.fromObject=function(){return new fabric.Image.filters.Grayscale},fabric.Image.filters.RemoveWhite=fabric.util.createClass({type:"RemoveWhite",initialize:function(t){t||(t={}),this.threshold=t.threshold||30,this.distance=t.distance||20},applyTo:function(t){for(var e,i,r,n=t.getContext("2d"),o=n.getImageData(0,0,t.width,t.height),s=o.data,a=this.threshold,c=this.distance,h=255-a,l=Math.abs,u=0,f=s.length;f>u;u+=4)e=s[u],i=s[u+1],r=s[u+2],e>h&&i>h&&r>h&&l(e-i)<c&&l(e-r)<c&&l(i-r)<c&&(s[u+3]=1);n.putImageData(o,0,0)},toJSON:function(){return{type:this.type,threshold:this.threshold,distance:this.distance}}}),fabric.Image.filters.RemoveWhite.fromObject=function(t){return new fabric.Image.filters.RemoveWhite(t)},fabric.Image.filters.Invert=fabric.util.createClass({type:"Invert",applyTo:function(t){var e,i=t.getContext("2d"),r=i.getImageData(0,0,t.width,t.height),n=r.data,o=n.length;for(e=0;o>e;e+=4)n[e]=255-n[e],n[e+1]=255-n[e+1],n[e+2]=255-n[e+2];i.putImageData(r,0,0)},toJSON:function(){return{type:this.type}}}),fabric.Image.filters.Invert.fromObject=function(){return new fabric.Image.filters.Invert},fabric.Image.filters.Sepia=fabric.util.createClass({type:"Sepia",applyTo:function(t){var e,i,r=t.getContext("2d"),n=r.getImageData(0,0,t.width,t.height),o=n.data,s=o.length;for(e=0;s>e;e+=4)i=.3*o[e]+.59*o[e+1]+.11*o[e+2],o[e]=i+100,o[e+1]=i+50,o[e+2]=i+255;r.putImageData(n,0,0)},toJSON:function(){return{type:this.type}}}),fabric.Image.filters.Sepia.fromObject=function(){return new fabric.Image.filters.Sepia},fabric.Image.filters.Sepia2=fabric.util.createClass({type:"Sepia2",applyTo:function(t){var e,i,r,n,o=t.getContext("2d"),s=o.getImageData(0,0,t.width,t.height),a=s.data,c=a.length;for(e=0;c>e;e+=4)i=a[e],r=a[e+1],n=a[e+2],a[e]=(.393*i+.769*r+.189*n)/1.351,a[e+1]=(.349*i+.686*r+.168*n)/1.203,a[e+2]=(.272*i+.534*r+.131*n)/2.14;o.putImageData(s,0,0)},toJSON:function(){return{type:this.type}}}),fabric.Image.filters.Sepia2.fromObject=function(){
return new fabric.Image.filters.Sepia2},fabric.Image.filters.Brightness=fabric.util.createClass({type:"Brightness",initialize:function(t){t||(t={}),this.brightness=t.brightness||100},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),r=i.data,n=this.brightness,o=0,s=r.length;s>o;o+=4)r[o]+=n,r[o+1]+=n,r[o+2]+=n;e.putImageData(i,0,0)},toJSON:function(){return{type:this.type,brightness:this.brightness}}}),fabric.Image.filters.Brightness.fromObject=function(t){return new fabric.Image.filters.Brightness(t)},fabric.Image.filters.Noise=fabric.util.createClass({type:"Noise",initialize:function(t){t||(t={}),this.noise=t.noise||100},applyTo:function(t){for(var e,i=t.getContext("2d"),r=i.getImageData(0,0,t.width,t.height),n=r.data,o=this.noise,s=0,a=n.length;a>s;s+=4)e=(.5-Math.random())*o,n[s]+=e,n[s+1]+=e,n[s+2]+=e;i.putImageData(r,0,0)},toJSON:function(){return{type:this.type,noise:this.noise}}}),fabric.Image.filters.Noise.fromObject=function(t){return new fabric.Image.filters.Noise(t)},fabric.Image.filters.GradientTransparency=fabric.util.createClass({type:"GradientTransparency",initialize:function(t){t||(t={}),this.threshold=t.threshold||100},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),r=i.data,n=this.threshold,o=r.length,s=0,a=r.length;a>s;s+=4)r[s+3]=n+255*(o-s)/o;e.putImageData(i,0,0)},toJSON:function(){return{type:this.type,threshold:this.threshold}}}),fabric.Image.filters.GradientTransparency.fromObject=function(t){return new fabric.Image.filters.GradientTransparency(t)},fabric.Image.filters.Tint=fabric.util.createClass({type:"Tint",initialize:function(t){t||(t={}),this.color=t.color||0},applyTo:function(t){var e,i,r=t.getContext("2d"),n=r.getImageData(0,0,t.width,t.height),o=n.data,s=o.length,a=parseInt(this.color).toString(16),c=parseInt("0x"+a.substr(0,2)),h=parseInt("0x"+a.substr(2,2)),l=parseInt("0x"+a.substr(4,2));for(e=0;s>e;e+=4)i=o[e+3],i>0&&(o[e]=c,o[e+1]=h,o[e+2]=l);r.putImageData(n,0,0)},toJSON:function(){return{type:this.type,color:this.color}}}),fabric.Image.filters.Tint.fromObject=function(t){return new fabric.Image.filters.Tint(t)},function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,r=e.util.object.clone,n=e.util.toFixed;return e.Text?void e.warn("fabric.Text is already defined"):e.Object?(e.Text=e.util.createClass(e.Object,{fontSize:40,fontWeight:100,fontFamily:"Times New Roman",textDecoration:"",textShadow:"",textAlign:"left",fontStyle:"",lineHeight:1.3,strokeStyle:"",strokeWidth:1,backgroundColor:"",path:null,type:"text",useNative:!0,initialize:function(t,e){this._initStateProperties(),this.text=t,this.setOptions(e||{}),this._theta=this.angle*Math.PI/180,this._initDimensions(),this.setCoords()},_initDimensions:function(){var t=e.document.createElement("canvas");t.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(t),this._render(t.getContext("2d"))},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat(),this.stateProperties.push("fontFamily","fontWeight","fontSize","path","text","textDecoration","textShadow","textAlign","fontStyle","lineHeight","strokeStyle","strokeWidth","backgroundColor","useNative"),e.util.removeFromArray(this.stateProperties,"width")},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(t){"undefined"==typeof Cufon||this.useNative===!0?this._renderViaNative(t):this._renderViaCufon(t)},_renderViaCufon:function(t){var e=Cufon.textOptions||(Cufon.textOptions={});e.left=this.left,e.top=this.top,e.context=t,e.color=this.fill;var i=this._initDummyElementForCufon();this.transform(t),Cufon.replaceElement(i,{engine:"canvas",separate:"none",fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,strokeStyle:this.strokeStyle,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor}),this.width=e.width,this.height=e.height,this._totalLineHeight=e.totalLineHeight,this._fontAscent=e.fontAscent,this._boundaries=e.boundaries,this._shadowOffsets=e.shadowOffsets,this._shadows=e.shadows||[],i=null,this.setCoords()},_renderViaNative:function(t){this.transform(t),this._setTextStyles(t);var e=this.text.split(/\r?\n/);this.width=this._getTextWidth(t,e),this.height=this._getTextHeight(t,e),this._renderTextBackground(t,e),"left"!==this.textAlign&&(t.save(),t.translate("center"===this.textAlign?this.width/2:this.width,0)),this._setTextShadow(t),this._renderTextFill(t,e),this.textShadow&&t.restore(),this._renderTextStroke(t,e),"left"!==this.textAlign&&t.restore(),this._renderTextDecoration(t,e),this._setBoundaries(t,e),this._totalLineHeight=0,this.setCoords()},_setBoundaries:function(t,e){this._boundaries=[];for(var i=0,r=e.length;r>i;i++){var n=t.measureText(e[i]).width,o=this._getLineLeftOffset(n);this._boundaries.push({height:this.fontSize,width:n,left:o})}},_setTextStyles:function(t){t.fillStyle=this.fill,t.strokeStyle=this.strokeStyle,t.lineWidth=this.strokeWidth,t.textBaseline="top",t.textAlign=this.textAlign,t.font=this._getFontDeclaration()},_getTextHeight:function(t,e){return this.fontSize*e.length*this.lineHeight},_getTextWidth:function(t,e){for(var i=t.measureText(e[0]).width,r=1,n=e.length;n>r;r++){var o=t.measureText(e[r]).width;o>i&&(i=o)}return i},_setTextShadow:function(t){if(this.textShadow){var e=/\s+(-?\d+)(?:px)?\s+(-?\d+)(?:px)?\s+(\d+)(?:px)?\s*/,i=this.textShadow,r=e.exec(this.textShadow),n=i.replace(e,"");t.save(),t.shadowColor=n,t.shadowOffsetX=parseInt(r[1],10),t.shadowOffsetY=parseInt(r[2],10),t.shadowBlur=parseInt(r[3],10),this._shadows=[{blur:t.shadowBlur,color:t.shadowColor,offX:t.shadowOffsetX,offY:t.shadowOffsetY}],this._shadowOffsets=[[parseInt(t.shadowOffsetX,10),parseInt(t.shadowOffsetY,10)]]}},_renderTextFill:function(t,e){this._boundaries=[];for(var i=0,r=e.length;r>i;i++)t.fillText(e[i],-this.width/2,-this.height/2+i*this.fontSize*this.lineHeight)},_renderTextStroke:function(t,e){if(this.strokeStyle)for(var i=0,r=e.length;r>i;i++)t.strokeText(e[i],-this.width/2,-this.height/2+i*this.fontSize*this.lineHeight)},_renderTextBackground:function(t,e){if(this.backgroundColor){t.save(),t.fillStyle=this.backgroundColor;for(var i=0,r=e.length;r>i;i++){var n=t.measureText(e[i]).width,o=this._getLineLeftOffset(n);t.fillRect(-this.width/2+o,-this.height/2+i*this.fontSize*this.lineHeight,n,this.fontSize)}t.restore()}},_getLineLeftOffset:function(t){return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:0},_renderTextDecoration:function(t,e){function i(i){for(var n=0,o=e.length;o>n;n++){var s=t.measureText(e[n]).width,a=this._getLineLeftOffset(s);t.fillRect(-this.width/2+a,i+n*this.fontSize*this.lineHeight-r,s,1)}}var r=this._getTextHeight(t,e)/2;this.textDecoration.indexOf("underline")>-1&&i.call(this,this.fontSize),this.textDecoration.indexOf("line-through")>-1&&i.call(this,this.fontSize/2),this.textDecoration.indexOf("overline")>-1&&i.call(this,0)},_getFontDeclaration:function(){return[this.fontStyle,this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},_initDummyElementForCufon:function(){var t=e.document.createElement("pre"),i=e.document.createElement("div");return i.appendChild(t),"undefined"==typeof G_vmlCanvasManager?t.innerHTML=this.text:t.innerText=this.text.replace(/\r?\n/gi,"\r"),t.style.fontSize=this.fontSize+"px",t.style.letterSpacing="normal",t},render:function(t,e){t.save(),this._render(t),!e&&this.active&&(this.drawBorders(t),this.hideCorners||this.drawCorners(t)),t.restore()},toObject:function(){return i(this.callSuper("toObject"),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,path:this.path,strokeStyle:this.strokeStyle,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,useNative:this.useNative})},toSVG:function(){var t=this.text.split(/\r?\n/),e=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,i=-(this.width/2),r=this.useNative?this.fontSize-1:this.height/2-t.length*this.fontSize-this._totalLineHeight,o=this._getSVGTextAndBg(e,i,t),s=this._getSVGShadows(e,t);return r+=this._fontAscent?this._fontAscent/5*this.lineHeight:0,['<g transform="',this.getSvgTransform(),'">',o.textBgRects.join(""),"<text ",this.fontFamily?"font-family=\"'"+this.fontFamily+"'\" ":"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',n(i,2)," ",n(r,2),')">',s.join(""),o.textSpans.join(""),"</text>","</g>"].join("")},_getSVGShadows:function(t,i){var r,o,s,a,c=[],h=1;if(!this._shadows||!this._boundaries)return c;for(r=0,s=this._shadows.length;s>r;r++)for(o=0,a=i.length;a>o;o++)if(""!==i[o]){var l=this._boundaries&&this._boundaries[o]?this._boundaries[o].left:0;c.push('<tspan x="',n(l+h+this._shadowOffsets[r][0],2),0===o||this.useNative?'" y':'" dy','="',n(this.useNative?t*o-this.height/2+this._shadowOffsets[r][1]:t+(0===o?this._shadowOffsets[r][1]:0),2),'" ',this._getFillAttributes(this._shadows[r].color),">",e.util.string.escapeXml(i[o]),"</tspan>"),h=1}else h++;return c},_getSVGTextAndBg:function(t,i,r){var o,s,a,c=[],h=[],l=1;for(o=0,a=r.length;a>o;o++)""!==r[o]?(s=this._boundaries&&this._boundaries[o]?n(this._boundaries[o].left,2):0,c.push('<tspan x="',s,'" ',0===o||this.useNative?"y":"dy",'="',n(this.useNative?t*o-this.height/2:t*l,2),'" ',this._getFillAttributes(this.fill),">",e.util.string.escapeXml(r[o]),"</tspan>"),l=1):l++,this.backgroundColor&&this._boundaries&&h.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',n(i+this._boundaries[o].left,2),'" y="',n(t*o-this.height/2,2),'" width="',n(this._boundaries[o].width,2),'" height="',n(this._boundaries[o].height,2),'"></rect>');return{textSpans:c,textBgRects:h}},_getFillAttributes:function(t){var i=t?new e.Color(t):"";return i&&i.getSource()&&1!==i.getAlpha()?'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},setColor:function(t){return this.set("fill",t),this},setFontsize:function(t){return this.set("fontSize",t),this._initDimensions(),this.setCoords(),this},getText:function(){return this.text},setText:function(t){return this.set("text",t),this._initDimensions(),this.setCoords(),this},_set:function(t,e){"fontFamily"===t&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+e+"$3")),this.callSuper("_set",t,e)}}),e.Text.ATTRIBUTE_NAMES="x y fill fill-opacity opacity stroke stroke-width transform font-family font-style font-weight font-size text-decoration".split(" "),e.Text.fromObject=function(t){return new e.Text(t.text,r(t))},void(e.Text.fromElement=function(t,i){if(!t)return null;var r=e.parseAttributes(t,e.Text.ATTRIBUTE_NAMES),i=e.util.object.extend(i?e.util.object.clone(i):{},r),n=new e.Text(t.textContent,i);return n})):void e.warn("fabric.Text requires fabric.Object")}("undefined"!=typeof exports?exports:this),function(){function request(t,e,i){var r=URL.parse(t),n=HTTP.createClient(r.port,r.hostname),o=n.request("GET",r.pathname,{host:r.hostname});n.addListener("error",function(t){t.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+n.host+":"+n.port):fabric.log(t.message)}),o.end(),o.on("response",function(t){var r="";e&&t.setEncoding(e),t.on("end",function(){i(r)}),t.on("data",function(e){200==t.statusCode&&(r+=e)})})}if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=new require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(t,e){request(t,"binary",function(i){var r=new Image;r.src=new Buffer(i,"binary"),r._src=t,e(r)})},fabric.loadSVGFromURL=function(t,e){t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),request(t,"",function(t){fabric.loadSVGFromString(t,e)})},fabric.loadSVGFromString=function(t,e){var i=(new DOMParser).parseFromString(t);fabric.parseSVGDocument(i.documentElement,function(t,i){e(t,i)})},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.Image.fromObject=function(t,e){fabric.util.loadImage(t.src,function(i){var r=new fabric.Image(i);r._initConfig(t),r._initFilters(t),e(r)})},fabric.createCanvasForNode=function(t,e){var i=fabric.document.createElement("canvas"),r=new Canvas(t||600,e||600);i.style={},i.width=r.width,i.height=r.height;var n=fabric.Canvas||fabric.StaticCanvas,o=new n(i);return o.contextContainer=r.getContext("2d"),o.nodeCanvas=r,o},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.Canvas&&fabric.Canvas.prototype.createPNGStream;var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(t){return origSetWidth.call(this),this.nodeCanvas.width=t,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(t){return origSetHeight.call(this),this.nodeCanvas.height=t,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}();var canvas,tshirts=new Array,a,b,line1,line2,line3,line4;$(document).ready(function(){canvas=new fabric.Canvas("tcanvas",{hoverCursor:"pointer",selection:!0,selectionBorderColor:"blue"}),canvas.on({"object:moving":function(t){t.target.opacity=.5},"object:modified":function(t){t.target.opacity=1},"object:selected":onObjectSelected,"selection:cleared":onSelectedCleared}),canvas.findTarget=function(t){return function(){var e=t.apply(this,arguments);return e?this._hoveredTarget!==e&&(canvas.fire("object:over",{target:e}),this._hoveredTarget&&canvas.fire("object:out",{target:this._hoveredTarget}),this._hoveredTarget=e):this._hoveredTarget&&(canvas.fire("object:out",{target:this._hoveredTarget}),this._hoveredTarget=null),e}}(canvas.findTarget),canvas.on("object:over",function(t){}),canvas.on("object:out",function(t){}),document.getElementById("add-text").onclick=function(){var t=$("#text-string").val(),e=new fabric.Text(t,{left:fabric.util.getRandomInt(0,200),top:fabric.util.getRandomInt(0,400),fontFamily:"helvetica",angle:0,fill:"#000000",scaleX:.5,scaleY:.5,fontWeight:"",hasRotatingPoint:!0});canvas.add(e),canvas.item(canvas.item.length-1).hasRotatingPoint=!0,$("#texteditor").css("display","block"),$("#imageeditor").css("display","block")},$("#text-string").keyup(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.text=this.value,canvas.renderAll())}),$(".img-polaroid").click(function(t){var e=t.target,i=50,r=fabric.util.getRandomInt(0+i,200-i),n=fabric.util.getRandomInt(0+i,400-i);fabric.util.getRandomInt(-20,40),fabric.util.getRandomInt(30,50),function(t,e){return Math.random()*(e-t)+t}(.5,1);fabric.Image.fromURL(e.src,function(t){t.set({left:r,top:n,angle:0,padding:10,cornersize:10,hasRotatingPoint:!0}),canvas.add(t)})}),document.getElementById("remove-selected").onclick=function(){var t=canvas.getActiveObject(),e=canvas.getActiveGroup();if(t)canvas.remove(t),$("#text-string").val("");else if(e){var i=e.getObjects();canvas.discardActiveGroup(),i.forEach(function(t){canvas.remove(t)})}},document.getElementById("bring-to-front").onclick=function(){var t=canvas.getActiveObject(),e=canvas.getActiveGroup();if(t)t.bringToFront();else if(e){var i=e.getObjects();canvas.discardActiveGroup(),i.forEach(function(t){t.bringToFront()})}},document.getElementById("send-to-back").onclick=function(){var t=canvas.getActiveObject(),e=canvas.getActiveGroup();if(t)t.sendToBack();else if(e){var i=e.getObjects();canvas.discardActiveGroup(),i.forEach(function(t){t.sendToBack()})}},$("#text-bold").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.fontWeight="bold"==t.fontWeight?"":"bold",canvas.renderAll())}),$("#text-italic").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.fontStyle="italic"==t.fontStyle?"":"italic",canvas.renderAll())}),$("#text-strike").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.textDecoration="line-through"==t.textDecoration?"":"line-through",canvas.renderAll())}),$("#text-underline").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.textDecoration="underline"==t.textDecoration?"":"underline",canvas.renderAll())}),$("#text-left").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.textAlign="left",canvas.renderAll())}),$("#text-center").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.textAlign="center",canvas.renderAll())}),$("#text-right").click(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.textAlign="right",canvas.renderAll())}),$("#font-family").change(function(){var t=canvas.getActiveObject();t&&"text"===t.type&&(t.fontFamily=this.value,canvas.renderAll())}),$("#text-bgcolor").miniColors({change:function(t,e){var i=canvas.getActiveObject();i&&"text"===i.type&&(i.backgroundColor=this.value,canvas.renderAll())},open:function(t,e){},close:function(t,e){}}),$("#text-fontcolor").miniColors({change:function(t,e){var i=canvas.getActiveObject();i&&"text"===i.type&&(i.fill=this.value,canvas.renderAll())},open:function(t,e){},close:function(t,e){}}),$("#text-strokecolor").miniColors({change:function(t,e){var i=canvas.getActiveObject();i&&"text"===i.type&&(i.strokeStyle=this.value,canvas.renderAll())},open:function(t,e){},close:function(t,e){}}),$("#drawingArea").hover(function(){canvas.add(line1),canvas.add(line2),canvas.add(line3),canvas.add(line4),canvas.renderAll()},function(){canvas.remove(line1),canvas.remove(line2),canvas.remove(line3),canvas.remove(line4),canvas.renderAll()}),$(".color-preview").click(function(){var t=$(this).css("background-color");document.getElementById("shirtDiv").style.backgroundColor=t}),$("#flip").click(function(){if("Show Back View"==$(this).attr("data-original-title")){$(this).attr("data-original-title","Show Front View"),$("#tshirtFacing").attr("src","img/crew_back.png"),a=JSON.stringify(canvas),canvas.clear();try{JSON.parse(b);canvas.loadFromJSON(b)}catch(t){}}else{$(this).attr("data-original-title","Show Back View"),$("#tshirtFacing").attr("src","img/crew_front.png"),b=JSON.stringify(canvas),canvas.clear();try{JSON.parse(a);canvas.loadFromJSON(a)}catch(t){}}canvas.renderAll(),setTimeout(function(){canvas.calcOffset()},200)}),$(".clearfix button,a").tooltip(),line1=new fabric.Line([0,0,200,0],{stroke:"#000000",strokeWidth:1,hasBorders:!1,hasControls:!1,hasRotatingPoint:!1,selectable:!1}),line2=new fabric.Line([199,0,200,399],{stroke:"#000000",strokeWidth:1,hasBorders:!1,hasControls:!1,hasRotatingPoint:!1,selectable:!1}),line3=new fabric.Line([0,0,0,400],{stroke:"#000000",strokeWidth:1,hasBorders:!1,hasControls:!1,hasRotatingPoint:!1,selectable:!1}),line4=new fabric.Line([0,400,200,399],{stroke:"#000000",strokeWidth:1,hasBorders:!1,hasControls:!1,hasRotatingPoint:!1,selectable:!1})}),jQuery&&function(t){t.extend(t.fn,{miniColors:function(e,i){var r=function(e,i,r){var n=x(e.val())||"ffffff",o=O(n),h=C(o),l=parseFloat(e.attr("data-opacity")).toFixed(2);l>1&&(l=1),0>l&&(l=0);var u=t('<a class="miniColors-trigger" style="background-color: #'+n+'" href="#"></a>');u.insertAfter(e),u.wrap('<span class="miniColors-triggerWrap"></span>'),i.opacity&&u.css("backgroundColor","rgba("+h.r+", "+h.g+", "+h.b+", "+l+")"),e.addClass("miniColors").data("original-maxlength",e.attr("maxlength")||null).data("original-autocomplete",e.attr("autocomplete")||null).data("letterCase","uppercase"===i.letterCase?"uppercase":"lowercase").data("opacity",!!i.opacity).data("alpha",l).data("trigger",u).data("hsb",o).data("change",i.change?i.change:null).data("close",i.close?i.close:null).data("open",i.open?i.open:null).attr("maxlength",7).attr("autocomplete","off").val("#"+g(n,i.letterCase)),(i.readonly||e.prop("readonly"))&&e.prop("readonly",!0),(i.disabled||e.prop("disabled"))&&s(e),u.on("click.miniColors",function(t){t.preventDefault(),""===e.val()&&e.val("#"),a(e)}),e.on("focus.miniColors",function(t){""===e.val()&&e.val("#"),a(e)}),e.on("blur.miniColors",function(t){var i=x(j(e.data("hsb")));e.val(i?"#"+g(i,e.data("letterCase")):"")}),e.on("keydown.miniColors",function(t){9===t.keyCode&&c(e)}),e.on("keyup.miniColors",function(t){p(e)}),e.on("paste.miniColors",function(t){setTimeout(function(){p(e)},5)})},n=function(e){c(),e=t(e),e.data("trigger").parent().remove(),e.attr("autocomplete",e.data("original-autocomplete")).attr("maxlength",e.data("original-maxlength")).removeData().removeClass("miniColors").off(".miniColors"),t(document).off(".miniColors")},o=function(t){t.prop("disabled",!1).data("trigger").parent().removeClass("disabled")},s=function(t){c(t),t.prop("disabled",!0).data("trigger").parent().addClass("disabled")},a=function(e){if(e.prop("disabled"))return!1;c();var i=t('<div class="miniColors-selector"></div>');i.append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>').append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"><div class="miniColors-colorPicker-inner"></div></div>').css("display","none").addClass(e.attr("class")),e.data("opacity")&&i.addClass("opacity").prepend('<div class="miniColors-opacity"><div class="miniColors-opacityPicker"></div></div>');var r=e.data("hsb");i.find(".miniColors-colors").css("backgroundColor","#"+j({h:r.h,s:100,b:100})).end().find(".miniColors-opacity").css("backgroundColor","#"+j({h:r.h,s:r.s,b:r.b})).end();var n=e.data("colorPosition");n||(n=v(r)),i.find(".miniColors-colorPicker").css("top",n.y+"px").css("left",n.x+"px");var o=e.data("huePosition");o||(o=b(r)),i.find(".miniColors-huePicker").css("top",o+"px");var s=e.data("opacityPosition");s||(s=m(e.attr("data-opacity"))),i.find(".miniColors-opacityPicker").css("top",s+"px"),e.data("selector",i).data("huePicker",i.find(".miniColors-huePicker")).data("opacityPicker",i.find(".miniColors-opacityPicker")).data("colorPicker",i.find(".miniColors-colorPicker")).data("mousebutton",0),t("BODY").append(i);var a=e.data("trigger"),h=!e.is(":visible"),d=h?a.offset().top+a.outerHeight():e.offset().top+e.outerHeight(),p=h?a.offset().left:e.offset().left,g=i.outerWidth(),y=i.outerHeight(),x=a.outerWidth(),w=a.outerHeight(),S=t(window).height(),_=t(window).width(),O=t(window).scrollTop(),T=t(window).scrollLeft();d+y>S+O&&(d=d-y-w),p+g>_+T&&(p=p-g+x),i.css({top:d,left:p}).fadeIn(100),i.on("selectstart",function(){return!1}),(!t.browser.msie||t.browser.msie&&t.browser.version>=9)&&t(window).on("resize.miniColors",function(t){c(e)}),t(document).on("mousedown.miniColors touchstart.miniColors",function(i){e.data("mousebutton",1);var r=t(i.target).parents().andSelf();return r.hasClass("miniColors-colors")&&(i.preventDefault(),e.data("moving","colors"),l(e,i)),r.hasClass("miniColors-hues")&&(i.preventDefault(),e.data("moving","hues"),u(e,i)),r.hasClass("miniColors-opacity")&&(i.preventDefault(),e.data("moving","opacity"),f(e,i)),r.hasClass("miniColors-selector")?void i.preventDefault():void(r.hasClass("miniColors")||c(e))}).on("mouseup.miniColors touchend.miniColors",function(t){t.preventDefault(),e.data("mousebutton",0).removeData("moving")}).on("mousemove.miniColors touchmove.miniColors",function(t){t.preventDefault(),1===e.data("mousebutton")&&("colors"===e.data("moving")&&l(e,t),"hues"===e.data("moving")&&u(e,t),"opacity"===e.data("moving")&&f(e,t))}),e.data("open")&&e.data("open").call(e.get(0),"#"+j(r),t.extend(C(r),{a:parseFloat(e.attr("data-opacity"))}))},c=function(e){e||(e=t(".miniColors")),e.each(function(){var i=t(this).data("selector");t(this).removeData("selector"),t(i).fadeOut(100,function(){if(e.data("close")){var i=e.data("hsb"),r=j(i);e.data("close").call(e.get(0),"#"+r,t.extend(C(i),{a:parseFloat(e.attr("data-opacity"))}))}t(this).remove()})}),t(document).off(".miniColors")},l=function(t,e){var i=t.data("colorPicker");i.hide();var r={x:e.pageX,y:e.pageY};e.originalEvent.changedTouches&&(r.x=e.originalEvent.changedTouches[0].pageX,r.y=e.originalEvent.changedTouches[0].pageY),r.x=r.x-t.data("selector").find(".miniColors-colors").offset().left-6,r.y=r.y-t.data("selector").find(".miniColors-colors").offset().top-6,r.x<=-5&&(r.x=-5),r.x>=144&&(r.x=144),r.y<=-5&&(r.y=-5),r.y>=144&&(r.y=144),t.data("colorPosition",r),i.css("left",r.x).css("top",r.y).show();var n=Math.round(.67*(r.x+5));0>n&&(n=0),n>100&&(n=100);var o=100-Math.round(.67*(r.y+5));0>o&&(o=0),o>100&&(o=100);var s=t.data("hsb");s.s=n,s.b=o,d(t,s,!0)},u=function(t,e){var i=t.data("huePicker");i.hide();var r=e.pageY;e.originalEvent.changedTouches&&(r=e.originalEvent.changedTouches[0].pageY),r=r-t.data("selector").find(".miniColors-colors").offset().top-1,-1>=r&&(r=-1),r>=149&&(r=149),t.data("huePosition",r),i.css("top",r).show();var n=Math.round(2.4*(150-r-1));0>n&&(n=0),n>360&&(n=360);var o=t.data("hsb");o.h=n,d(t,o,!0)},f=function(t,e){var i=t.data("opacityPicker");i.hide();var r=e.pageY;e.originalEvent.changedTouches&&(r=e.originalEvent.changedTouches[0].pageY),r=r-t.data("selector").find(".miniColors-colors").offset().top-1,-1>=r&&(r=-1),r>=149&&(r=149),t.data("opacityPosition",r),i.css("top",r).show();var n=parseFloat((150-r-1)/150).toFixed(2);0>n&&(n=0),n>1&&(n=1),t.data("alpha",n).attr("data-opacity",n),d(t,t.data("hsb"),!0)},d=function(e,i,r){e.data("hsb",i);var n=j(i),o=t(e.data("selector"));r&&e.val("#"+g(n,e.data("letterCase"))),o.find(".miniColors-colors").css("backgroundColor","#"+j({h:i.h,s:100,b:100})).end().find(".miniColors-opacity").css("backgroundColor","#"+n).end();var s=C(i);if(e.data("trigger").css("backgroundColor","#"+n),e.data("opacity")&&e.data("trigger").css("backgroundColor","rgba("+s.r+", "+s.g+", "+s.b+", "+e.attr("data-opacity")+")"),e.data("change")){if(n+","+e.attr("data-opacity")===e.data("lastChange"))return;e.data("change").call(e.get(0),"#"+n,t.extend(C(i),{a:parseFloat(e.attr("data-opacity"))})),e.data("lastChange",n+","+e.attr("data-opacity"))}},p=function(e){e.val("#"+y(e.val()));var i=x(e.val());if(!i)return!1;var r=O(i),n=v(r),o=t(e.data("colorPicker"));o.css("top",n.y+"px").css("left",n.x+"px"),e.data("colorPosition",n);var s=b(r),a=t(e.data("huePicker"));a.css("top",s+"px"),e.data("huePosition",s);var c=m(e.attr("data-opacity")),h=t(e.data("opacityPicker"));return h.css("top",c+"px"),e.data("opacityPosition",c),d(e,r),!0},g=function(t,e){return"uppercase"===e?t.toUpperCase():t.toLowerCase()},v=function(t){var e=Math.ceil(t.s/.67);0>e&&(e=0),e>150&&(e=150);var i=150-Math.ceil(t.b/.67);return 0>i&&(i=0),i>150&&(i=150),{x:e-5,y:i-5}},b=function(t){var e=150-t.h/2.4;return 0>e&&(h=0),e>150&&(h=150),e},m=function(t){var e=150*t;return 0>e&&(e=0),e>150&&(e=150),150-e},y=function(t){return t.replace(/[^A-F0-9]/gi,"")},x=function(t){return(t=y(t))?(3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),6===t.length?t:null):null},C=function(t){var e={},i=Math.round(t.h),r=Math.round(255*t.s/100),n=Math.round(255*t.b/100);if(0===r)e.r=e.g=e.b=n;else{var o=n,s=(255-r)*n/255,a=(o-s)*(i%60)/60;360===i&&(i=0),60>i?(e.r=o,e.b=s,e.g=s+a):120>i?(e.g=o,e.b=s,e.r=o-a):180>i?(e.g=o,e.r=s,e.b=s+a):240>i?(e.b=o,e.r=s,e.g=o-a):300>i?(e.b=o,e.g=s,e.r=s+a):360>i?(e.r=o,e.g=s,e.b=o-a):(e.r=0,e.g=0,e.b=0)}return{r:Math.round(e.r),g:Math.round(e.g),b:Math.round(e.b)}},w=function(e){var i=[e.r.toString(16),e.g.toString(16),e.b.toString(16)];return t.each(i,function(t,e){1===e.length&&(i[t]="0"+e)}),i.join("")},S=function(t){return t=parseInt(t.indexOf("#")>-1?t.substring(1):t,16),{r:t>>16,g:(65280&t)>>8,b:255&t}},_=function(t){var e={h:0,s:0,b:0},i=Math.min(t.r,t.g,t.b),r=Math.max(t.r,t.g,t.b),n=r-i;return e.b=r,e.s=0!==r?255*n/r:0,0!==e.s?t.r===r?e.h=(t.g-t.b)/n:t.g===r?e.h=2+(t.b-t.r)/n:e.h=4+(t.r-t.g)/n:e.h=-1,e.h*=60,e.h<0&&(e.h+=360),e.s*=100/255,e.b*=100/255,e},O=function(t){var e=_(S(t));return 0===e.s&&(e.h=360),e},j=function(t){return w(C(t))};switch(e){case"readonly":return t(this).each(function(){t(this).hasClass("miniColors")&&t(this).prop("readonly",i)}),t(this);case"disabled":return t(this).each(function(){t(this).hasClass("miniColors")&&(i?s(t(this)):o(t(this)))}),t(this);case"value":if(void 0===i){if(!t(this).hasClass("miniColors"))return;var T=t(this),A=x(T.val());return A?"#"+g(A,T.data("letterCase")):null}return t(this).each(function(){t(this).hasClass("miniColors")&&(t(this).val(i),p(t(this)))}),t(this);case"opacity":if(void 0===i){if(!t(this).hasClass("miniColors"))return;return t(this).data("opacity")?parseFloat(t(this).attr("data-opacity")):null}return t(this).each(function(){t(this).hasClass("miniColors")&&(0>i&&(i=0),i>1&&(i=1),t(this).attr("data-opacity",i).data("alpha",i),p(t(this)))}),t(this);case"destroy":return t(this).each(function(){t(this).hasClass("miniColors")&&n(t(this))}),t(this);default:return e||(e={}),t(this).each(function(){"input"===t(this)[0].tagName.toLowerCase()&&(t(this).data("trigger")||r(t(this),e,i))}),t(this)}}})}(jQuery);